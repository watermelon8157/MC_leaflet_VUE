@using System.Data;
@using RCS_Data;
@using RCS.Models;
@{
    List<SysParams> ResultStrList = (List<SysParams>)ViewData["ResultStrList"];//CXR下拉清單
                                                                               //DataTable dt = ViewBag.dt;
    IPDPatientInfo patInfo = (IPDPatientInfo)Session["pat_info"];
    string dateTimeNow = DateTime.Now.ToString("yyyy-MM-dd HH:mm");//設定載入的現在時間
                                                                   //string New_Cpt_ID = (string)ViewData["New_Cpt_ID"];
    string cpt_id = "", date_def = DateTime.Now.ToString("yyyy-MM-dd");
    if (ViewData["New_Cpt_ID"] == null) { ViewData["New_Cpt_ID"] = ""; }
    string CPT_id = ViewData["New_Cpt_ID"].ToString();
    string last_cpt_id = ViewData["last_cpt_id"].ToString();
    string temp_cpt_date = ViewData["cpt_date"].ToString();
    //string CPTID=cpt_id.Select(x => x.cpt_id).ToString();
    // string or_date = string.Empty, or_item = string.Empty, or_pkkey = string.Empty;
    string[] sound_item = { "Clear", "Stridor", "Crackles", "Rhonchi", "Wheeze", "Bronchial_sound", "Decreased", "Absent" }; 
    List<SysParams> conscious_e = (List<SysParams>)ViewData["conscious_e"]; //意識E下拉清單
    List<SysParams> conscious_v = (List<SysParams>)ViewData["conscious_v"]; //意識V下拉清單
    List<SysParams> conscious_m = (List<SysParams>)ViewData["conscious_m"]; //意識M下拉清單
    List<SysParams> pat_problem_list = (List<SysParams>)ViewData["pat_problem"]; //病人主要呼吸問題清單
}


<style type="text/css">
    #record_form .row {
        padding: 3px 0px;
    }

    .span_w180 {
        display: inline-block;
        width: 180px;
    }

    .span_w100 {
        display: inline-block;
        width: 100px;
    }

    #rtuserrecordTable label {
        margin-right: 10px;
    }

    #tab_rt_cpt_assess .banner_block {
        display: inline-block;
        padding: 0.3em 0.5em;
        margin: 0.5em 0;
        border: 1px solid #5BA198;
        border-left-width: 10px;
        border-radius: 0.3em;
        font-size: 18px;
        color: #000000;
    }

    #tab_rt_cpt_assess .table > tbody > tr > td {
        vertical-align: middle;
        padding: 4px;
    }

    #tab_rt_cpt_assess .table label, #tab_rt_cpt_assess .table input {
        padding: 0px 2px;
        margin: 0px;
    }

    #tab_rt_cpt_assess .table > tbody > tr > td:first-child {
        width: 180px;
    }

    #tab_rt_cpt_assess .table input[type=text] {
        padding: 2px 2px;
        height: auto;
    }

    #tab_rt_cpt_assess .table input[type=checkbox] {
        width: 15px;
        height: 15px;
    }

    #tab_rt_cpt_assess .panel > .panel-heading:not(:first-child) {
        border: 1px solid #faebcc;
        height: 38px;
        line-height: 1.8em;
        padding: 0.2em 1em;
    }

    #div_CXR_detail .input-group > span.input-group-addon:first-child {
        width: 100px;
    }

    .modal {
        overflow-y: auto;
    }
    /* Important part */
    .modal-content {
        /*overflow-y:auto;*/
    }

    .modal-dialog {
        overflow-y: initial !important;
    }

    #cpt_record_body {
        height: 40%;
        width: auto;
        /*overflow-y:initial !important;*/
    }
</style>

<!-- 手術病人及胸腔物理治療[評估表] -->


<div class="modal fade col-lg-12 col-xs-12" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" id="cpt_record_panel">
    <div class="modal-dialog modal-lg" style="margin: auto;height:900px;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="rcs_form" id="cpt_form">
                    <div class="modal-header col-*-12">
                        <div class="btn-group col-*-6">
                            姓名：<label id="record_form_pat_name">@Html.Raw(patInfo.patient_name)</label>&emsp;&emsp;
                            病歷號：<label id="record_form_bed_no">@Html.Raw(patInfo.bed_no)</label>&emsp;&emsp;
                        </div>


                        <div class="btn-group pull-right">

                            @*<button class="btn btn-success exec-func" data-loading-text="帶入中..." onclick="OpenWork_data()"><span class="glyphicon glyphicon-list-alt"></span>&nbsp;統計註記</button>*@
                            @if (!string.IsNullOrWhiteSpace(CPT_id))
                            {
                                <button id="delAssess_btn" class="btn btn-danger" onclick="cpt_data_del();" data-loading-text="刪除中..." delType>刪除</button>
                                                            <button class="btn btn-primary" id="cpt_print" onclick="print_cpt($(this), '@CPT_id');" notlock>
                                                                <span class="glyphicon glyphicon-print"></span>&nbsp;列印
                                                            </button>

                            } 
                            <button id="getAssess_btn" class="btn btn-primary" onclick="get_cpt_data('@last_cpt_id', $('#weaning_cpt_date').val(), true)" data-loading-text="取得中..." chktype>取得最後一筆資料</button>
                            <button id="saveAssess_btn" class="btn btn-success" onclick="saveAssess($(this))" data-loading-text="儲存中..." chktype>儲存</button>
                            <button class="btn btn-warning" data-dismiss="modal" onclick="refreshCPT_Assess_table();"><span class="glyphicon glyphicon-folder-close"></span>&nbsp;關閉</button>
                        </div>
                    </div>
                </div>
                <div class="modal-body" id="cpt_record_body">
                    <form name="assess_form" id="cpt_assess_form" class="form-inline cptzerofix">
                        <input type="hidden" id="RtGrantListtempid" />
                        <input type="hidden" class="form-control" data-rcs-cate="work_data" id="work_data" name="work_data" value="">
                        <input type="hidden" class="form-control" id="cpt_ass_cpt_id" data-rcs-cate="cpt_id" />

                        @*<div class="col-lg-4 col-lg-offset-8 col-sm-12 col-sm-offset-0">
                                <div class="input-group">
                                    <span class="input-group-addon">記錄日期</span>
                                    <input class="form-control dt-picker" dt-format="dt" dt-sidebyside="true" id="weaning_cpt_date" data-rcs-cate="cpt_date" value="@(DateTime.Now.ToString("yyyy-MM-dd HH:mm"))" readonly notlock />
                                </div>
                            </div>*@
                        <div id="cpt_assess_dt" style="position:relative;"></div>
                        <div class="panel panel-warning" id="cpt_detail_from">
                            <div class="panel-heading">入院病史及評估</div>
                            <div class="panel-body">
                                <table class="table table-bordered table-condensed table-striped" style="background-color: #FFF; margin-bottom: 0;" id="rtuserrecordTable">
                                    <tr>
                                        <td style="width:150px;"><label for="diag_date">入院日期</label></td>
                                        <td colspan="2" class=" ">
                                            <input type="text" class="form-control dt-picker" readonly data-rcs-cate="diag_date" id="diag_date" dt-format="dt" dt-sidebyside="true" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width:150px;"><label for="record_date">評估日期</label></td>
                                        <td>
                                            <input class="form-control dt-picker" dt-format="dt" dt-sidebyside="true" id="weaning_cpt_date" data-rcs-cate="record_date" value="@(DateTime.Now.ToString("yyyy-MM-dd HH:mm"))" readonly="" notlock />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width:150px;"><label for="ipd_category">轉入前病房類別</label></td>
                                        <td colspan="2" class="form-block set_check single_check" data-rcs-cate="from_unit">
                                            <label class="disab_text_label" for="from_unit_2"><input type="checkbox" class="checkbox-inline checkbox-vertical" id="from_unit_2" value="ER" data-rcs-text="ER" />ER</label>
                                            <label class="disab_text_label" for="from_unit_3"><input type="checkbox" class="checkbox-inline checkbox-vertical" id="from_unit_3" value="Ward" data-rcs-text="Ward" />Ward</label>
                                            <label class="disab_text_label" for="from_unit_7"><input type="checkbox" class="checkbox-inline checkbox-vertical" id="from_unit_7" value="ICU" data-rcs-text="ICU" />ICU</label>
                                            <label class="disab_text_label" for="from_unit_4"><input type="checkbox" class="checkbox-inline checkbox-vertical" id="from_unit_4" value="RCC" data-rcs-text="RCC" />RCC</label>
                                            <label class="disab_text_label other" for="from_unit_10">
                                                <input type="checkbox" class="checkbox-inline checkbox-vertical" id="from_unit_10" value="其他" data-rcs-text="其他" />其他
                                                <input type="text" class="form-control input-sm" id="from_unit_11" maxlength="30" />
                                            </label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="now_pat_diagnosis">
                                                診斷&ensp;
                                                <span class="display_count" id="now_diagnosis_display_count"></span>
                                            </label>
                                        </td>
                                        <td colspan="2">
                                            <textarea class="form-control"
                                                      onkeyup="onkeyup_Textarea_Count('now_diagnosis_display_count', 'now_diagnosis');"
                                                      data-rcs-cate="now_pat_diagnosis" id="now_diagnosis" rows="3" style="width:100%" maxlength="3000"></textarea>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width:150px;"><label for="record_date">肺部病史</label></td>
                                        <td colspan="2" class="form-block" data-rcs-cate="cpt_history">
                                            <label class="disab_text_label" for="cpt_ass_cpt_history_1"><input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_cpt_history_1" value="Asthma" data-rcs-text="Asthma" />Asthma</label>
                                            <label class="disab_text_label" for="cpt_ass_cpt_history_2"><input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_cpt_history_2" value="COPD" data-rcs-text="COPD" />COPD</label>
                                            <label class="disab_text_label" for="cpt_ass_cpt_history_3"><input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_cpt_history_3" value="TB/Old TB" data-rcs-text="TB/Old TB" />TB/Old TB</label>
                                            <label class="disab_text_label" for="cpt_ass_cpt_history_4"><input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_cpt_history_4" value="Lung cancer" data-rcs-text="Lung cancer" />Lung cancer</label>
                                            <label class="disab_text_label" for="cpt_ass_cpt_history_5"><input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_cpt_history_5" value="Pneumoconiosis" data-rcs-text="Pneumoconiosis" />Pneumoconiosis</label>
                                            <label class="disab_text_label other" for="cpt_ass_cpt_history_6">
                                                <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_cpt_history_6" value="其他" data-rcs-text="其他" />其他
                                                <input type="text" class="form-control input-sm" id="cpt_ass_cpt_history_7" maxlength="30" />
                                            </label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="diagnosis">
                                                入院病史&ensp;
                                                <span class="display_count" id="diagnosis_display_count"></span>
                                            </label>
                                        </td> @*20180517修改*@
                                        <td colspan="2">
                                            <textarea class="form-control"
                                                      onkeyup="onkeyup_Textarea_Count('diagnosis_display_count', 'diagnosis');"
                                                      data-rcs-cate="diagnosis" id="diagnosis" rows="3" style="width:100%" maxlength="300"></textarea>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="history_diag">
                                                其他病史&ensp;
                                                <span class="display_count" id="history_diag_display_count"></span>
                                            </label>
                                        </td>
                                        <td colspan="2">
                                            <textarea class="form-control"
                                                      onkeyup="onkeyup_Textarea_Count('history_diag_display_count', 'history_diag');"
                                                      data-rcs-cate="history_diag" id="history_diag" rows="3" style="width:100%" maxlength="300"></textarea>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label for="rt_reason">使用呼吸器原因</label></td>
                                        <td colspan="2">
                                            <div class="form-block" data-rcs-cate="rt_reason">
                                                @{
                                                    var rt_reason_list = new string[] {
                                            "Type I respiratory failure"
                                            , "Type II respiratory failure"
                                            , "Trauma"
                                            , "Excessive work of breathing"
                                            , "Out-of-hospital cardiac arrest"
                                            , "In-hospital cardiac arrest"
                                            , "Post-op(手術名稱)"
                                            , "Other"
                                        };
                                                    for (int i = 0; i <= rt_reason_list.Length - 1; i++)
                                                    {
                                                        if (rt_reason_list[i] == "Other")
                                                        {
                                                            <br />
                                                            <label for="rt_reason_@(i)" class="disab_text_label other">
                                                                <input type="checkbox" class="checkbox-inline checkbox-vertical" id="rt_reason_@(i)" value="@(rt_reason_list[i])" data-rcs-text="@(rt_reason_list[i])" />@(rt_reason_list[i])
                                                                <input type="text" class="form-control input-sm" id="rt_reason_other" maxlength="50" style="width:350px;"/>
                                                            </label>
                                                        }
                                                        else if (rt_reason_list[i] == "Post-op(手術名稱)")
                                                        {
                                                            <br />
                                                            <label for="rt_reason_@(i)" class="disab_text_label other">
                                                                <input type="checkbox" class="checkbox-inline checkbox-vertical" id="rt_reason_@(i)" value="@(rt_reason_list[i])" data-rcs-text="@(rt_reason_list[i])" />@(rt_reason_list[i])
                                                                <select id="rt_reason_Post" name="rt_reason_Post" style="background-color:#FFF;width:350px;" class="form-control editable_select input-sm">
                                                                    <option value=""></option>
                                                                </select>
                                                            </label> 
                                                        }
                                                        else if (rt_reason_list[i] == "Trauma")
                                                        {
                                                            <label for="rt_reason_@(i)" class="disab_text_label other">
                                                                <input type="checkbox" class="checkbox-inline checkbox-vertical" id="rt_reason_@(i)" value="@(rt_reason_list[i])" data-rcs-text="@(rt_reason_list[i])" />@(rt_reason_list[i])
                                                                <input type="text" class="form-control input-sm" id="rt_reason_Trauma" maxlength="50" />
                                                            </label>
                                                        }
                                                        else
                                                        {
                                                            <label for="rt_reason_@(i)" class="disab_text_label">
                                                                <input type="checkbox" class="checkbox-inline checkbox-vertical" id="rt_reason_@(i)" value="@(rt_reason_list[i])" data-rcs-text="@(rt_reason_list[i])" /> @(rt_reason_list[i])
                                                            </label>
                                                        }
                                                    }
                                                }
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <!-- 呼吸氣道狀況 -->
                            <div class="panel-heading">呼吸氣道狀況</div>
                            <div class="panel-body">
                                <table class="table table-bordered table-condensed table-striped form-block" data-rcs-cate="brief_status" style="background-color: #FFF; margin-bottom: 0;" id="brief_status">
                                    <tr>
                                        <td colspan="2">
                                            插管時間：<span style="position:relative;"><input class="form-control dt-picker" dt-sidebyside="true" dt-format="d" type="text" id="tube_time" name="tube_time" readonly="readonly" /></span>&nbsp;&nbsp;
                                            ETT 管徑：<input class="form-control" type="text" id="tube_width" name="tube_width" /> mm&nbsp;&nbsp;
                                            深度：<input class="form-control" type="text" id="tube_deep" name="tube_deep" /> cm&nbsp;&nbsp;
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            氣切時間：<span style="position:relative;"><input class="form-control dt-picker" dt-sidebyside="true" dt-format="d" type="text" id="shiley_time" name="shiley_time" readonly="readonly" /></span>&nbsp;&nbsp;
                                            Tr. 管徑：<input class="form-control" type="text" id="shiley_width" name="shiley_width" /> mm&nbsp;&nbsp;
                                            @*深度：<input class="form-control" type="text" id="shiley_deep" name="shiley_deep" /> cm&nbsp;&nbsp;*@
                                            廠牌：
                                            <label>
                                                <select id="shiley_kind" name="shiley_kind" style="background-color:#FFF;width:100px;" class="form-control editable_select input-sm">
                                                    <option value="Portex">Portex</option>
                                                    <option value="Bivona">Bivona</option>
                                                    <option value="Shiley">Shiley</option>
                                                    <option value="Mallinckrodt">Mallinckrodt</option>
                                                </select>
                                            </label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width:150px;"><label for="rt_start_time">呼吸器開始使用日期</label></td>
                                        <td><span style="position:relative;"><input class="form-control dt-picker" dt-sidebyside="true" dt-format="dt" type="text" id="rt_start_time" name="rt_start_time" readonly="readonly" /></span></td>
                                    </tr>
                                    <tr>
                                        <td><label for="rt_start_respirator_model">呼吸器機型</label></td>
                                        <td>
                                            <label>
                                                <select id="rt_start_respirator_model" name="rt_start_respirator_model" style="background-color:#FFF;width:200px;" class="form-control editable_select input-sm">
                                                    <option value=""></option>
                                                    <option value="Airvo 2">Airvo 2</option>
                                                    <option value="C1">C1</option>
                                                    <option value="EvitaXL">EvitaXL</option>
                                                    <option value="Evita2dura">Evita2dura</option>
                                                    <option value="Evita4">Evita4</option>
                                                    <option value="Infant Star">Infant Star</option>
                                                    <option value="NPV">NPV</option>
                                                    <option value="Savina">Savina</option>
                                                    <option value="Sechrist">Sechrist</option>
                                                    <option value="Servo i">Servo i</option>
                                                    <option value="Servo 900C">Servo 900C</option>
                                                    <option value="Servo-S">Servo-S</option>
                                                    <option value="SLE">SLE</option>
                                                    <option value="Stellar">Stellar</option>
                                                    <option value="Synchrony">Synchrony</option>
                                                    <option value="T-bird">T-bird</option>
                                                    <option value="VELA">VELA</option>
                                                    <option value="VIP-Bird">VIP-Bird</option>
                                                    <option value="VPAP">VPAP</option>
                                                    <option value="300C">300C</option>
                                                    @*TODO:上線後需進資料庫修改*@
                                                </select>
                                            </label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label for="rt_start_if">呼吸器使用介面</label></td>
                                        <td>
                                            <label>
                                                <select id="rt_start_if" name="rt_start_if" style="background-color:#FFF;width:200px;" class="form-control editable_select input-sm">
                                                    <option value="ETT">ETT</option>
                                                    <option value="Tr">Tr</option>
                                                    <option value="Mask">Mask</option>
                                                    <option value="Nasal prong">Nasal prong</option>
                                                </select>
                                            </label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label for="rt_start_model">呼吸器使用模式</label></td>
                                        <td>
                                            <span style="position:relative;">
                                                Mode
                                                <input class="form-control input-sm" style="width:12%" type="text" id="rt_start_model_1" name="rt_start_model_1" /> &nbsp;&nbsp;
                                                FiO<sub>2</sub>
                                                <input class="form-control input-sm" style="width:12%" type="text" id="rt_start_model_2" name="rt_start_model_2" />%  &nbsp;&nbsp;
                                                PEEP
                                                <input class="form-control input-sm" style="width:12%" type="text" id="rt_start_model_3" name="rt_start_model_3" />cmH2O &nbsp;&nbsp;
                                            </span>
                                            <br />
                                            <span style="position:relative;">

                                                VT/PC
                                                <input class="form-control input-sm" style="width:12%" type="text" id="rt_start_model_4" name="rt_start_model_4" /> &nbsp;&nbsp;
                                                RR
                                                <input class="form-control input-sm" style="width:12%" type="text" id="rt_start_model_5" name="rt_start_model_5" />bpm &nbsp;&nbsp;
                                            </span>
                                            <br />
                                            <span style="position:relative;">
                                                IPAP/EPAP (CPAP)
                                                <input class="form-control input-sm" style="width:12%" type="text" id="rt_start_model_6" name="rt_start_model_6" /> &nbsp;&nbsp;
                                                /
                                                <input class="form-control input-sm" style="width:12%" type="text" id="rt_start_model_7" name="rt_start_model_7" />cmH2O &nbsp;&nbsp;
                                            </span>
                                        </td>
                                    </tr>                                  
                                </table>
                            </div>      
                            <div class="panel-heading">手術 <input type="button" value="選取" onclick="LoadORListChecked()"></div>
                            <div class="panel-body">
                                <div class="row" id="ORList">
                                    <table class="table table-bordered table-striped table-condensed form-block" data-rcs-cate="operation" style="width:90%;margin:0 20px 0 30px;display:none" id="table_orlist">
                                        <tr id="0">
                                            <th>手術日期</th>
                                            <th>手術方式</th>
                                        </tr>
                                    </table>
                                </div> 
                                <div class="row" style="display:none;" id="ORSelectedList">
                                    <div class="col-md-2" onclick="SetDateTimeNow($('.date_surgery'));">手術日期</div>
                                    <div class="col-md-4"><input type="text" class="form-control dt-picker" dt-format="dt" dt-sidebyside="true" name="date_surgery" placeholder="手術日期" readonly="readonly" /></div>
                                    <div class="col-md-2">手術方式</div>
                                    <div class="col-md-4"><input type="text" class="form-control input-sm" name="txt_op_fun" placeholder="手術方式" style="width:100%" readonly="readonly" /></div>
                                </div>
                            </div>               
                            <div class="panel-heading">血液生化</div>
                            <div class="panel-body">
                                <table class="table table-bordered table-condensed table-striped" style="background-color: #FFF; margin-bottom: 0;" id="rtuserrecordTable">
                                    <tr>
                                        <td style="width:150px;">ABG</td>
                                        <td class="form-block" data-rcs-cate="abg_data">
                                            <span style="position:relative;">
                                                <span onclick="SetDateTimeNow($('#cpt_ass_abg_1'));">日期：</span>
                                                <input type="text" class="form-control dt-picker" dt-format="d" dt-sidebyside="true" id="cpt_ass_abg_1" readonly="readonly" maxlength="5" />
                                                @*<span onclick="SetDateTimeNow($('#cpt_ass_abg_11'));">時間：</span>
                                                <input type="text" class="form-control dt-picker" dt-format="t" dt-sidebyside="true" id="cpt_ass_abg_11" readonly="readonly" maxlength="5" />*@
                                                <br />
                                                pH
                                                <input type="text" class="form-control input-sm keyreal abgitem" id="cpt_ass_abg_2" style="width:8%" maxlength="5" />
                                                ,PaCO<sub>2</sub>(mmHg)
                                                <input type="text" class="form-control input-sm abgitem" id="cpt_ass_abg_10" style="width:8%" maxlength="5" />
                                                ,PaO<sub>2</sub>(mmHg)
                                                <input type="text" class="form-control input-sm abgitem" id="cpt_ass_abg_3" style="width:8%" maxlength="5" />
                                            </span>
                                            <br />
                                            <span>
                                                ,HCO<sub>3</sub>(mmol/L)
                                                <input type="text" class="form-control input-sm keyreal abgitem" id="cpt_ass_abg_7" style="width:8%" maxlength="5" />
                                                ,BE(mmol/L)
                                                <input type="text" class="form-control input-sm keyreal abgitem" id="cpt_ass_abg_9" style="width:8%" maxlength="5" />
                                                ,SaO<sub>2</sub>(%)
                                                <input type="text" class="form-control input-sm keyreal abgitem" id="cpt_ass_abg_8" style="width:8%" maxlength="5" />
                                                ,FiO<sub>2</sub>(%)
                                                <input type="text" class="form-control input-sm keyreal abgitem" id="cpt_ass_abg_12" style="width:8%" maxlength="5" />

                                                <br />
                                                Device
                                                <select id="cpt_ass_abg_13" name="cpt_ass_abg_13" style="background-color:#FFF;width:200px;" class="form-control editable_select input-sm">
                                                    <option value="Device">Device</option>
                                                </select>
                                            </span>
                                        </td>
                                    </tr>                                
                                </table>
                            </div>
                            <div class="panel-heading">呼吸系統評估</div>
                            <div class="panel-body">
                                <table class="table table-bordered table-condensed table-striped" style="background-color: #FFF; margin-bottom: 0;" id="rtuserrecordTable">
                                    <tr>
                                        <td>意識狀態</td>
                                        <td colspan="2" class="form-block" data-rcs-cate="conscious">
                                            <span class="singleChk">
                                                <label>
                                                    EVM：
                                                    <label>
                                                        @Html.DropDownList("conscious_e", new SelectList(conscious_e, "p_value", "p_name"), new { @id = "cpt_ass_conscious_4", @class = "form-control input-sm", @style = "background-color:#FFF;width:80px;", @type = "select" })
                                                    </label>
                                                    /
                                                    <label>
                                                        @Html.DropDownList("conscious_v", new SelectList(conscious_v, "p_value", "p_name"), new { @id = "cpt_ass_conscious_5", @class = "form-control input-sm", @style = "background-color:#FFF;width:80px;", @type = "select" })
                                                    </label>
                                                    /
                                                    <label>
                                                        @Html.DropDownList("conscious_m", new SelectList(conscious_m, "p_value", "p_name"), new { @id = "cpt_ass_conscious_6", @class = "form-control input-sm", @style = "background-color:#FFF;width:80px;", @type = "select" })
                                                    </label>
                                                </label>
                                                <label>
                                                    <select id="cpt_ass_conscious_1" name="cpt_ass_conscious_1" style="background-color:#FFF;width:200px;" class="form-control editable_select input-sm">
                                                        <option value="Good">Good</option>
                                                        <option value="Poor">Poor</option>
                                                    </select>
                                                </label>
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>身體評估：身高／體重／IBW</td>
                                        <td colspan="2" class="singleChk form-block" data-rcs-cate="conscious">
                                            身高：
                                            <input type="text" class="form-control input-sm keyreal" id="body_height" style="width:8%" placeholder="身高" maxlength="5" /> cm
                                            &emsp;體重：
                                            <input type="text" class="form-control input-sm keyreal" id="body_weight" style="width:8%" placeholder="體重" maxlength="5" /> kg
                                            &emsp;
                                            <button class="btn btn-default" onclick="PBW(); return false;">
                                                <span class="glyphicon glyphicon-edit"></span> predicted body weight
                                            </button>
                                            &emsp;IBW：
                                            <input type="text" class="form-control input-sm keyreal" id="f_body_weight" style="width:8%" readonly />
                                            <br />
                                            IBW：
                                            <br />
                                            男性 ( 身高 – 80 ) × 0.7
                                            <br />
                                            女性 ( 身高 – 70 ) × 0.6
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label for="record_time">抽菸史</label></td>
                                        <td colspan="2">
                                            <span class="set_check form-block" data-rcs-cate="smoke_history">
                                                <label class="disab_text_label" for="cpt_ass_smoke_history_1">
                                                    <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_smoke_history_1" value="無" data-rcs-text="無" />無
                                                </label>
                                                <span class="disab_text_label other">
                                                    <label for="cpt_ass_smoke_history_2">
                                                        <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_smoke_history_2" value="有" data-rcs-text="有" />有
                                                    </label>
                                                    <input type="text" class="form-control input-sm keyreal txt_smoke_1" id="cpt_ass_smoke_history_3" maxlength="3" />PPD 
                                                    <input type="text" class="form-control input-sm keyreal txt_smoke_1" id="cpt_ass_smoke_history_4" maxlength="2" />年
                                                </span>
                                                <label class="disab_text_label other" for="cpt_ass_smoke_history_5">
                                                    <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_smoke_history_5" value="已戒菸" data-rcs-text="已戒菸" />已戒菸 
                                                    <input type="text" class="form-control input-sm keyreal" id="cpt_ass_smoke_history_6" maxlength="2" />年
                                                </label>
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>呼吸型態</td>
                                        <td colspan="2">
                                            <span class="form-block" style="display:inline-block;vertical-align:top" data-rcs-cate="patterns">
                                                <span class="single_check">
                                                    <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_patterns_1" value="無呼吸" data-rcs-text="無呼吸" /><label for="cpt_ass_patterns_1">無呼吸</label>
                                                    <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_patterns_2" value="正常呼吸" data-rcs-text="正常呼吸" /><label for="cpt_ass_patterns_2">正常呼吸</label>
                                                </span>&nbsp;
                                                <span class="single_check">
                                                    <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_patterns_4" value="淺快" data-rcs-text="淺快" /><label for="cpt_ass_patterns_4">淺快</label>
                                                    <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_patterns_3" value="深快" data-rcs-text="深快" /><label for="cpt_ass_patterns_3">深快</label>
                                                </span>
                                                @*<span class="single_check">
                                                        <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_patterns_5" value="快" data-rcs-text="快" /><label for="cpt_ass_patterns_5">快</label>
                                                        <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_patterns_6" value="慢" data-rcs-text="慢" /><label for="cpt_ass_patterns_6">慢</label>
                                                    </span>*@
                                                <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_patterns_7" value="使用輔助肌" data-rcs-text="使用輔助肌" /><label for="cpt_ass_patterns_7">使用輔助肌</label>
                                                <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_patterns_8" value="異常胸腹運動" data-rcs-text="異常胸腹運動" /><label for="cpt_ass_patterns_8">異常胸腹運動(Paradoxical movement)</label>
                                                <label for="cpt_ass_patterns_9" class="disab_text_label other">
                                                    <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_patterns_9" value="其他" data-rcs-text="其他" />其他
                                                    <input type="text" class="form-control input-sm" id="cpt_ass_patterns_10" maxlength="50" />
                                                </label>
                                            </span>
                                        </td>
                                    </tr>                              
                                    <tr>
                                        <td>呼吸音</td>
                                        @*<td style="width:150px;">
                                                呼吸音異常標示位置代號：<br />
                                                <img src="~/Images/deviant_s.jpg" class="img-rounded" alt="呼吸音異常位置圖" width="116" height="100">
                                            </td>*@
                                        <td colspan="2" valign="top">
                                            <div id="div_sound" class="form-block" data-rcs-cate="breath_sound">
                                                <span class="other" item_cate="Coarse">
                                                    <label>
                                                        <input type="checkbox" class="form-item checkbox-inline checkbox-vertical firstChk form-field" data-clear="Y" item_id="p_SOUND_Coarse" id="cpt_ass_sound_1" value="Coarse" />&nbsp;Coarse
                                                    </label>
                                                    (
                                                    @for (int j = 1, q = 2; j < 7 && q < 8; j++, q++)
                                                    {
                                                        <label>
                                                            <input type="checkbox" class="form-item checkbox-inline checkbox-vertical sub-form-field" item_id="p_SOUND_Coarse_TXT" id="cpt_ass_sound_@(q)" value="@j" data-rcs-text="@(j)">&nbsp;
                                                            @if (j == 1)
                                                            {
                                                                @Html.Raw("bilateral")
                                                            }
                                                            else if (j == 2)
                                                            {
                                                                @Html.Raw("RUL")
                                                            }
                                                            else if (j == 3)
                                                            {
                                                                @Html.Raw("RML")
                                                            }
                                                            else if (j == 4)
                                                            {
                                                                @Html.Raw("RLL")
                                                            }
                                                            else if (j == 5)
                                                            {
                                                                @Html.Raw("LUL")
                                                            }
                                                            else if (j == 6)
                                                            {
                                                                @Html.Raw("LLL")
                                                            }
                                                        </label>
                                                    }
                                                    )
                                                </span>
                                                <br />
                                                <span class="other" item_cate="Crackle">
                                                    <label>
                                                        <input type="checkbox" class="form-item checkbox-inline checkbox-vertical firstChk form-field" data-clear="Y" item_id="p_SOUND_Crackle" id="cpt_ass_sound_8" value="Crackle" />&nbsp;Crackle
                                                    </label>
                                                    (
                                                    @for (int j = 1, q = 9; j < 7 && q < 15; j++, q++)
                                                    {
                                                        <label>
                                                            <input type="checkbox" class="form-item checkbox-inline checkbox-vertical sub-form-field" item_id="p_SOUND_Crackle_TXT" id="cpt_ass_sound_@(q)" value="@j" data-rcs-text="@(j)">&nbsp;
                                                            @if (j == 1)
                                                            {
                                                                @Html.Raw("bilateral")
                                                            }
                                                            else if (j == 2)
                                                            {
                                                                @Html.Raw("RUL")
                                                            }
                                                            else if (j == 3)
                                                            {
                                                                @Html.Raw("RML")
                                                            }
                                                            else if (j == 4)
                                                            {
                                                                @Html.Raw("RLL")
                                                            }
                                                            else if (j == 5)
                                                            {
                                                                @Html.Raw("LUL")
                                                            }
                                                            else if (j == 6)
                                                            {
                                                                @Html.Raw("LLL")
                                                            }
                                                        </label>
                                                    }
                                                    )
                                                </span>
                                                <br />
                                                <span class="other" item_cate="Wheeze">
                                                    <label>
                                                        <input type="checkbox" class="form-item checkbox-inline checkbox-vertical firstChk form-field" data-clear="Y" item_id="p_SOUND_WHEEZE" id="cpt_ass_sound_15" value="Wheeze" />&nbsp;Wheezing
                                                    </label>
                                                    (
                                                    @for (int j = 1, q = 16; j < 7 && q < 22; j++, q++)
                                                    {
                                                        <label>
                                                            <input type="checkbox" class="form-item checkbox-inline checkbox-vertical sub-form-field" item_id="p_SOUND_WHEEZE_TXT" id="cpt_ass_sound_@(q)" value="@j" data-rcs-text="@(j)">&nbsp;
                                                            @if (j == 1)
                                                            {
                                                                @Html.Raw("bilateral")
                                                            }
                                                            else if (j == 2)
                                                            {
                                                                @Html.Raw("RUL")
                                                            }
                                                            else if (j == 3)
                                                            {
                                                                @Html.Raw("RML")
                                                            }
                                                            else if (j == 4)
                                                            {
                                                                @Html.Raw("RLL")
                                                            }
                                                            else if (j == 5)
                                                            {
                                                                @Html.Raw("LUL")
                                                            }
                                                            else if (j == 6)
                                                            {
                                                                @Html.Raw("LLL")
                                                            }
                                                        </label>
                                                    }
                                                    )
                                                </span>
                                                <br />
                                                <span class="other" item_cate="Rhonchi">
                                                    <label>
                                                        <input type="checkbox" class="form-item checkbox-inline checkbox-vertical firstChk form-field" data-clear="Y" item_id="p_SOUND_Rhonchi" id="cpt_ass_sound_22" value="Rhonchi" />&nbsp;Rhonchi
                                                    </label>
                                                    (
                                                    @for (int j = 1, q = 23; j < 7 && q < 29; j++, q++)
                                                    {
                                                        <label>
                                                            <input type="checkbox" class="form-item checkbox-inline checkbox-vertical sub-form-field" item_id="p_SOUND_Rhonchi_TXT" id="cpt_ass_sound_@(q)" value="@j" data-rcs-text="@(j)">&nbsp;
                                                            @if (j == 1)
                                                            {
                                                                @Html.Raw("bilateral")
                                                            }
                                                            else if (j == 2)
                                                            {
                                                                @Html.Raw("RUL")
                                                            }
                                                            else if (j == 3)
                                                            {
                                                                @Html.Raw("RML")
                                                            }
                                                            else if (j == 4)
                                                            {
                                                                @Html.Raw("RLL")
                                                            }
                                                            else if (j == 5)
                                                            {
                                                                @Html.Raw("LUL")
                                                            }
                                                            else if (j == 6)
                                                            {
                                                                @Html.Raw("LLL")
                                                            }
                                                        </label>
                                                    }
                                                    )
                                                </span>
                                                <br />
                                                <span class="other" item_cate="Decreased">
                                                    <label>
                                                        <input type="checkbox" class="form-item checkbox-inline checkbox-vertical firstChk form-field" data-clear="Y" item_id="p_SOUND_Decreased" id="cpt_ass_sound_33" value="Decreased" />&nbsp;Decreased
                                                    </label>
                                                    (
                                                    @for (int j = 1, q = 34; j < 7 && q < 40; j++, q++)
                                                    {
                                                        <label>
                                                            <input type="checkbox" class="form-item checkbox-inline checkbox-vertical sub-form-field" item_id="p_SOUND_Decreased_TXT" id="cpt_ass_sound_@(q)" value="@j" data-rcs-text="@(j)">&nbsp;
                                                            @if (j == 1)
                                                            {
                                                                @Html.Raw("bilateral")
                                                            }
                                                            else if (j == 2)
                                                            {
                                                                @Html.Raw("RUL")
                                                            }
                                                            else if (j == 3)
                                                            {
                                                                @Html.Raw("RML")
                                                            }
                                                            else if (j == 4)
                                                            {
                                                                @Html.Raw("RLL")
                                                            }
                                                            else if (j == 5)
                                                            {
                                                                @Html.Raw("LUL")
                                                            }
                                                            else if (j == 6)
                                                            {
                                                                @Html.Raw("LLL")
                                                            }
                                                        </label>
                                                    }
                                                    )
                                                </span>
                                                <br />
                                                <span class="other" item_cate="Other">
                                                    @*<label>
                                                            <input type="checkbox" class="form-item checkbox-inline checkbox-vertical firstChk form-field" data-clear="Y" item_id="p_SOUND_Other" id="cpt_ass_sound_40" value="Other" />&nbsp;其他
                                                        </label>*@
                                                    <label for="cpt_ass_sound_40" class="disab_text_label other">
                                                        <input type="checkbox" class="form-item checkbox-inline checkbox-vertical firstChk form-field" data-clear="Y" item_id="p_SOUND_Other" id="cpt_ass_sound_40" value="Other" />&nbsp;其他
                                                        <input type="text" class="form-control input-sm" id="cpt_ass_sound_47" maxlength="50" />
                                                    </label>
                                                    (
                                                    @for (int j = 1, q = 41; j < 7 && q < 47; j++, q++)
                                                    {
                                                        <label>
                                                            <input type="checkbox" class="form-item checkbox-inline checkbox-vertical sub-form-field" item_id="p_SOUND_Other_TXT" id="cpt_ass_sound_@(q)" value="@j" data-rcs-text="@(j)">&nbsp;
                                                            @if (j == 1)
                                                            {
                                                                @Html.Raw("bilateral")
                                                            }
                                                            else if (j == 2)
                                                            {
                                                                @Html.Raw("RUL")
                                                            }
                                                            else if (j == 3)
                                                            {
                                                                @Html.Raw("RML")
                                                            }
                                                            else if (j == 4)
                                                            {
                                                                @Html.Raw("RLL")
                                                            }
                                                            else if (j == 5)
                                                            {
                                                                @Html.Raw("LUL")
                                                            }
                                                            else if (j == 6)
                                                            {
                                                                @Html.Raw("LLL")
                                                            }
                                                        </label>
                                                    }
                                                    )
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>咳嗽能力</td>
                                        <td colspan="2" class="form-block" data-rcs-cate="cough">
                                            <span class="single_check">
                                                <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_cough_1" value="Functional" data-rcs-text="Functional" /><label for="cpt_ass_cough_1">Functional</label>
                                                <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_cough_2" value="weakly funcational" data-rcs-text="weakly funcational" /><label for="cpt_ass_cough_2">weakly funcational</label>
                                                <input type="checkbox" class="checkbox-inline checkbox-vertical" id="cpt_ass_cough_3" value="Non-functional" data-rcs-text="Non-functional" /><label for="cpt_ass_cough_3">Non-functional</label>
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>痰液評估</td>
                                        <td colspan="2" class="form-block" data-rcs-cate="sputum_assess">
                                            <span>
                                                排出方式：
                                                <select id="cpt_ass_sputum_ass_0" name="cpt_ass_sputum_ass_0" style="background-color:#FFF;width:100px;" class="form-control input-sm">
                                                    <option value="">請選擇</option>
                                                     <option value="抽吸">抽吸</option>
                                                    <option value="自咳">自咳</option>
                                                </select>
                                            </span>
                                            <br />
                                            <span>
                                                痰液性狀：
                                                <br />
                                                量：
                                                <select id="cpt_ass_sputum_ass_1" name="cpt_ass_sputum_ass_1" style="background-color:#FFF;width:100px;" class="form-control input-sm">
                                                    <option value="">請選擇</option>
                                                    <option value="少">少</option>
                                                    <option value="中">中</option>
                                                    <option value="多">多</option>
                                                </select>
                                                質：
                                                <select id="cpt_ass_sputum_ass_2" name="cpt_ass_sputum_ass_2" style="background-color:#FFF;width:100px;" class="form-control input-sm">
                                                    <option value="">請選擇</option>
                                                    <option value="稀">稀</option>
                                                    <option value="微稠">微稠</option>
                                                    <option value="稠">稠</option>
                                                    <option value="結塊">結塊</option>
                                                </select>
                                                色：
                                                <select id="cpt_ass_sputum_ass_3" name="cpt_ass_sputum_ass_3" style="background-color:#FFF;width:100px;" class="form-control input-sm">
                                                    <option value="">請選擇</option>
                                                    <option value="白">白</option>
                                                    <option value="黃">黃</option>
                                                    <option value="綠">綠</option>
                                                    <option value="褐">褐</option>
                                                    <option value="鮮紅">鮮紅</option>
                                                    <option value="粉紅">粉紅</option>
                                                </select>
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label>
                                                備註&ensp;
                                                <span class="display_count" id="other_history_display_count"></span>
                                            </label>
                                        </td>
                                        <td colspan="2">
                                            <textarea class="form-control"
                                                      onkeyup="onkeyup_Textarea_Count('other_history_display_count', 'other_history');"
                                                      data-rcs-cate="other_history" id="other_history" rows="3" style="width:100%" maxlength="3000"></textarea>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            @*<div class="panel-heading">特殊狀況描述</div>
                                <div class="panel-body">
                                    <table class="table table-bordered table-striped table-condensed">
                                        <tr>
                                            <td>
                                                特殊狀況描述&ensp;
                                                <span class="display_count" id="cpt_memo_display_count"></span>
                                            </td>
                                            <td>
                                                <textarea class="form-control"
                                                          onkeyup="onkeyup_Textarea_Count('cpt_memo_display_count', 'cpt_ass_cpt_memo');"
                                                          data-rcs-cate="cpt_memo" id="cpt_ass_cpt_memo" rows="5" style="width:100%" maxlength="1000"></textarea>
                                            </td>
                                        </tr>
                                    </table>
                                </div>*@
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


@*<div class="modal fade setScrollbar phraseCarry" role="dialog" id="div_modify_CXR">
        <input type="hidden" id="CXR_ID" name="CXR_ID" />
        <input type="hidden" id="CXR_json" name="CXR_json" />
        <div class="modal-dialog">
            <div class="modal-content form-inline" style="width: 500px;">
                <div class="modal-header">
                    <div class="btn-group">
                        <input type="button" class="btn btn-danger" id="deleteCXR" data-dismiss="modal" onclick="delCXR();" value="刪除" />
                    </div>
                    <h4 class="modal-title" style=" display:inline-block; margin:0 1em;">CXR檢查</h4>
                    <div class="btn-group">
                        <input type="button" id="resetCXR_btn" class="btn btn-default " onclick="resetCXR();" value="清除" />
                        <input type="button" id="saveCXR_btn" class="btn btn-success" onclick="modifyCXR()" value="確認" />
                        <input type="button" class="btn btn-warning" data-dismiss="modal" value="關閉" />
                    </div>
                </div>
                <div class="modal-body rcs_form div_CXR_detail" id="div_CXR_detail">
                    <div class="row">
                        <div class="col-md-4">
                            <canvas class="result_canvas" id="Result_XYs" name="Result_XYs" width="120" height="120"></canvas>
                        </div>
                        <div class="col-md-8">
                            <div class="input-group">
                                <span class="input-group-addon" onclick="SetDateTimeNow($('#Result_Date'));">檢查日期</span>
                                <input type="text" id="Result_Date" name="Result_Date" value="" class="form-control dt-picker" dt-format="dt" dt-sidebyside="true" readonly="readonly" placeholder="檢查日期" style="width:181px;">
                            </div>
                            <br />
                            <div class="input-group" style="margin: 0.5em 0;">
                                <span class="input-group-addon">大小</span>
                                <div style="width:148px; height:32px; border:1px solid #ccc; display:inline-block;">
                                    <div id="pen_size" style="width: 134px; margin: 0.5em 0.3em;"></div>
                                </div>
                                <span class="input-group-addon" id="pen_width">4</span>
                            </div>

                            <div class="input-group">
                                <span class="input-group-addon">結果</span>
                                <input type="hidden" id="image_file_key" name="image_file_key" />
                                @Html.DropDownList("Result_Str", new SelectList(ResultStrList, "P_VALUE", "P_NAME"), new { @class = "form-control editable_select", @placeholder = "結果", @autocomplete = "off" })
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>*@
@*統計註記資料*@
<div id="cpt_work_panel_div">
    <div class="modal fade setScrollbar" tabindex="-1" role="dialog" id="cpt_work_panel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="btn-group pull-right" style="margin-top: 0.3em;">
                        <button class="btn btn-success" v-on:click="save"><span class="glyphicon glyphicon-save"></span>&nbsp;儲存</button>
                        <button class="btn btn-warning" data-dismiss="modal"><span class="glyphicon glyphicon-folder-close"></span>&nbsp;關閉</button>
                    </div>
                    <h4 class="modal-title">統計註記</h4>
                </div>
                <div class="modal-body">
                    <div class="panel panel-default">
                        <div class="panel-heading">統計註記</div>
                        <div class="panel-body">
                            <label>
                                <input type="checkbox" v-model="checkList" value="Bronchoscopy" />
                                &ensp;Bronchoscopy
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="送檢/ C-T" />
                                &ensp;送檢/ C-T
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="On endo" />
                                &ensp;On endo
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="CPCR/999" />
                                &ensp;CPCR/999
                            </label>&ensp;
                        </div>
                    </div>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

</div>
<form id="cpt_pdf_form" action="@(Url.Content("~/CPT/DownloadPdf_CPTPage"))" method="post" target="TheNewWindow">
    <input type="hidden" id="HtmlStrCXR2" name="HtmlStrCXR2" />
</form>


<div class="modal fade" role="dialog" id="div_select_orlist">
    @{Html.RenderPartial("CPTAssessOP");}
</div>
<script type="text/javascript">
    var cpt_work_panel_set_vm = { checkList: [] };//預設物件
    var cpt_work_panel_vm = new Vue({
        el: '#cpt_work_panel_div',
        data: [cpt_work_panel_set_vm, {}].reduce(function (r, o) {
            Object.keys(o).forEach(function (k) {
                r[k] = o[k];
            });
            return r;
        }, {}),
        mounted: function () {
            //元素已掛載，el被建立

        },
        methods: {
            //Vue Instance 在初始化時可設定選項物件，其中可設定 method，執行一些動作。
            save: function () {
                $('#cpt_assess_form #work_data').val(JSON.stringify(this.checkList));
                $('#cpt_work_panel').modal("hide");
            },
            open: function () {
                if (!!$('#cpt_assess_form #work_data').val()) {
                    this.checkList = JSON.parse($('#cpt_assess_form #work_data').val());
                } else {
                    this.checkList = [];
                }
                $('#cpt_work_panel').modal("show");
            }
        },
        computed: {
            //當我們定義一個 computed，其相依 data 一變，computed 也會隨之更新。

        },
        watch: {
            //當事件觸發時，瀏覽器叫事件處理器work。

        }
    });

    var cxr_empty_img = new Image();
    cxr_empty_img.src = "@Url.Content("~/Images/deviant_empty.png")";
    //CXR 標示
    //取得canvas context
    var cxr_xys = [];
    var $canvas = $("#Result_XYs");
    var cpt_data;

    function refreshCPT_Assess_table() {
        $('#CPT_Assess_table').each(function () {
            $(this).bootstrapTable('refresh');
        });
    }
    function cpt_data_del() {
        if (confirm("是否確定刪除?")) {
            $('#delAssess_btn').button('loading');
            $.ajax({
                url: "@Url.Content("~/CPT/cpt_data_del")",
                type: "post",
                data: { CPT_ID: $('#cpt_ass_cpt_id').val() },
                dataType: "json",
                timeout: 10000,
                success: function (data) {
                    if (data.status == 0) {
                        $('#delAssess_btn').button('reset');
                        alert(data.message);
                        $("#cpt_assess_form")[0].reset();
                        $("#cpt_record_panel").modal("hide");
                        refreshCPT_Assess_table();

                    } else {
                        alert(data.message);
                    }
                }
            });
        }
    };
    function OpenWork_data() {
        cpt_work_panel_vm.open();
    }
    // 2016-5-10 Joe Shen
    // 取得CPT主表資料並塞上介面
    function get_cpt_data(pCPT_ID, pCpt_date, pIsLast) {
        $.ajax({
            url: "@Url.Content("~/CPT/CPTindexData")",
            type: "post",
            //data: { pCpdId: $('#cpt_ass_ipd_bed').val() },
            data: { CPT_ID: pCPT_ID, cpt_date: pCpt_date },
            dataType: "json",
            timeout: 10000,
            success: function (data) {
                //debugger;
                if (data != null && data.length > 0) {
                    var cpt_data = data[0]; 
                    if (cpt_data.cpt_id != null && cpt_data.cpt_id != '') {
                        if (!!pIsLast) {
                            cpt_data.work_data = '';
                            cpt_data.cpt_id = $('#cpt_ass_cpt_id').val();
                            cpt_data.abg_data = [];
                            cpt_data.base_data = [];
                            cpt_data.conscious = [];
                            cpt_data.tip = [];
                            cpt_data.skin = [];
                            cpt_data.patterns = [];
                            cpt_data.breath_sound = [];
                            cpt_data.cough = [];
                            cpt_data.sputum = [];
                            cpt_data.sputum_assess = [];
                            cpt_data.pat_problem = [];
                            cpt_data.record_date = null;
                            cpt_data.diag_date = null;
                            console.log(cpt_data)
                        }
                        fillJsonDom('cpt_assess_form', cpt_data);
                        //if (cpt_data.CXR_result_json != null && cpt_data.CXR_result_json != '') {
                        //    cxr_xys = JSON.parse(cpt_data.CXR_result_json);
                        //    $('#CXR_result_json').val(cpt_data.CXR_result_json);
                        //}
                        LoadORList(cpt_data.operation);
                        //CXR_build();
                        ctpsetzerofix();

                    } else {
                        fillJsonDom('cpt_assess_form', cpt_data);
                        //如果為新的表單，預設為局部麻醉有勾
                        //$('#cpt_assess_form input[value=局部麻醉]').prop('checked', true);
                    }
                } else {
                    //cpt_date
                    $('#cpt_assess_form input[data-rcs-cate=cpt_date]').val('@(dateTimeNow)');
                    //$('#cpt_assess_form input[value=局部麻醉]').prop('checked', true);
                }
            }
        });
    }

    function HideNewAssessOption(pHide) {
        if (pHide) {
            $("#cpt_ass_ipd_bed option[value='']").hide();
        } else {
            $("#cpt_ass_ipd_bed option[value='']").show();
            $('#cpt_ass_ipd_bed').val('');
        }
    }



    function ClearFormData() {
        //清空控件
        $(':input', '#cpt_assess_form')
        .removeAttr('checked')
        .removeAttr('selected')
        .not(':button, :submit, :reset, :hidden, :radio, :checkbox')
        .val('');
        $('#CXR_result_json').val('');
        //清空手術
        $('#ORList').html('');
        var newOP = "<table class='table table-bordered table-striped table-condensed form-block' data-rcs-cate='operation' style='width:90%;margin:0 20px 0 30px;display:none' id='table_orlist'>";
        newOP += "<tr id='0'>";
        newOP += "<th>手術日期</th>";
        newOP += "<th>手術方式</th>";
        newOP += "</tr>";
        newOP += "</table>";
        $('#ORList').html(newOP);
        //清空CXR
        //$('#CXR_table').html('');
        var newCXR = "<tbody><tr id='CXRdate'>";
        newCXR += "<th>檢查日期</th></tr>";
        newCXR += "<tr id='CXRresult'>";
        newCXR += "<th>檢查結果</th></tr></tbody>";
        $('#CXR_table').html(newCXR);
    }


    function RenderPatientOperation() {
        $.ajax({
            url: "@Url.Content("~/CPT/CPTAssessOP")",
            type: "post",
            timeout: 10000,
            data: { pCptId: $('#cpt_ass_cpt_id').val() },
            dataType: "html",
            success: function (response) {
                $('#div_select_orlist').html(response);
            }
        });
    }

    function LoadORList(data) {
        if (data != null) {
            var tmp_html = '';
            for (var i = 0; i < data.length; i++) {
                var table_obj = data[i];
                if (table_obj.id.indexOf('cpt_ass_operation_or_date') >= 0) {
                    tmp_html = '';
                    tmp_html = "<td>" + table_obj.val + "<input type='hidden' name='or_date' id='" + table_obj.id + "' value='" + table_obj.val + "' /></td>";
                }
                else if (table_obj.id.indexOf('cpt_ass_operation_or_item') >= 0) {
                    tmp_html += "<td>" + table_obj.val + "<input type='hidden' name='or_item' id='" + table_obj.id + "' value='" + table_obj.val + "' />";
                } else {
                    tmp_html += "<input type='hidden' name='or_pkkey' id='" + table_obj.id + "' value='" + table_obj.val + "'></td>";
                    $("#table_orlist tr:last").after("<tr id=" + table_obj.val + ">" + tmp_html + "</tr>");
                }
            }
            $("#table_orlist").show();
        }
    }

    function LoadORListChecked() {
        RenderPatientOperation();
        if ($("#table_orlist").find("tr").length > 1) {
            $("#table_orlist").find("tr").each(function () {
                $("input[name=ck_or][pk=" + $(this).attr("id") + "]").prop("checked", true);
            });
        }
        $('#div_select_orlist').modal('show');
    }

    function appendORList() {
        var pList = [];
        if ($("input[name=ck_or]:checked").length > 0) {
            $("#table_orlist").find("tr:not(:nth-child(1))").remove();
            $("input[name=ck_or]:checked").each(function (i) {
                var this_td = $(this).parent("td");
                var or_date = this_td.next("td").text();
                var or_item = this_td.next("td").next("td").text();
                var tmp_html = "<td>" + this_td.next("td").text() + "<input type='hidden' name='or_date' id='cpt_ass_operation_or_date_" + i + "' value='' /></td>";
                tmp_html += "<td>" + this_td.next("td").next("td").text() + "<input type='hidden' name='or_item' id='cpt_ass_operation_or_item_" + i + "' value='' />";
                tmp_html += "<input type='hidden' name='or_pkkey' id='or_pkkey_" + i + "' value=''></td>";
                $("#table_orlist tr:last").after("<tr id=" + $(this).attr("pk") + ">" + tmp_html + "</tr>");
                $("#cpt_ass_operation_or_date_" + i).val(or_date);
                $("#cpt_ass_operation_or_item_" + i).val(or_item);
                pList.push(or_item);
                $("#or_pkkey_" + i).val($(this).attr("pk"));
            });
            $("#rt_reason_Post").val(pList.join(','));
            $("#rt_reason_6").prop('checked', true);
            $("#table_orlist").show();
        }
        else {
            $("#table_orlist").hide().find("tr:not(:nth-child(1))").remove();
        }
        $('#div_select_orlist').modal('hide');
        $("input[name=ck_or]").attr("checked", false);
    }

    //寫入DB前 檢查記錄日期有無填
    var success = true;
    function check_The_Inputs_Not_Empty() {
        $('#rtuserrecordTable').each(function () {
            if ($('#cpt_assess_form #weaning_cpt_date').val() == '' || $('#cpt_assess_form #weaning_cpt_date').val() == null || $('#cpt_assess_form #weaning_cpt_date').val() == undefined) {
                alert('【記錄日期】不可空白!');
                $('#weaning_cpt_date').focus();
                success = false;
                return;
            } else {
                success = true;
            }
        })
    };

    function saveAssess(btn) {


        var Json = $("#cpt_assess_form").serializeObject();
        var tmpJSON = JSON.stringify(Json);
        var CXR_result_json = "";
        var image = "";

        //if (Json['CXR_result_json'] != "") {
        //    CXR_result_json = JSON.parse(Json['CXR_result_json']);
        //    var listJson = CXR_result_json["0"];
        //    var pointJson = listJson['Result_XYs'];
        //    var canvas = document.getElementById('Show_Result_XYs_0');
        //    var type = 'image/jpeg';
        //    //將canvas元素中的圖像轉變為DataURL
        //    var dataurl = canvas.toDataURL(type);
        //    //圖片格式
        //    image = dataurl.replace('data:image/jpeg;base64,', '');
        //}

        cpt_dtl_json_data = getJsonObject('cpt_assess_form');
        cpt_dtl_json_data["obj"] = tmpJSON;
        cpt_dtl_json_data["imageData"] = image;

        console.log(cpt_dtl_json_data)

        check_The_Inputs_Not_Empty();
        if (success) {
            $.ajax({
                type: 'post',
                url: "@Url.Content("~/CPT/CPTAssess_Save")",
                data: JSON.stringify(cpt_dtl_json_data),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    btn.button('loading');
                },
                success: function (data) {
                    btn.button('reset');
                    if (data.status == 0) {
                        alert(data.message);
                        $("#cpt_assess_form")[0].reset();
                        $("#cpt_record_panel").modal("hide");
                        refreshCPT_Assess_table()
                    } else {
                        alert(data.message);
                    }
                },
                complete: function () {
                    btn.button('reset');
                    //  重新載入資料避免重複輸入主檔

                    //$("#main_content > ul > li > a[data-target='#tab_rt_cpt_assess']").trigger("click");
                    //$("#cpt_record_panel").modal("hide");

                }
            });
        }
    }

    function set_for_rb(rb_name, dvalue) {
        if (dvalue != '') {
            $("#tab_rt_cpt_assess #cpt_form input[name='" + rb_name + "']").each(function () {
                if ($(this).val() == dvalue)
                    $(this).prop("checked", true);
            });
        }
    }

    function set_for_ck(ck_name, val) {
        if (val != '') {
            var default_val = val.split("|");
            var ck = $("#tab_rt_cpt_assess #cpt_form input[name='" + ck_name + "']");
            for (var i = 0; i < default_val.length; i++) {
                for (var j = 0; j < ck.length; j++) {
                    if (default_val[i] == ck[j].value)
                        $(ck[j]).click();
                }
            }
        }
    }



    function setRule() {
        setSingleChk();
        setGroupChk();
        setmutichk();
    }

    //////////////////   待移除

    function setmutichk() {
        var block = $('#cpt_assess_form .mutichk');
        block.each(function () {
            //console.log("多選");
            var chk = $(this).find('input:checkbox');
            var chklst = $(this).find('input:checkbox').last();
            var txt1st = $(this).find('input:text').first();
            var txt = $(this).find('input:text').not(txt1st);
            chk.each(function () {
                var item = $(this);
                item.unbind('click').click(function () {
                    var checkedValues = new Array();
                    chk.each(function () {
                        var chkitem = $(this);
                        if (chkitem[0].checked) {
                            if (chkitem[0].id == chklst[0].id) {
                                checkedValues.push(chkitem.val() + '：' + txt.val());
                            } else {
                                checkedValues.push(chkitem.val());
                            }
                        }
                    });
                    txt1st.val(checkedValues.join(','));
                });
            });
            txt.each(function () {
                var item = $(this);
                item.unbind('keyup').keyup(function () {
                    var checkedValues = new Array();
                    chk.each(function () {
                        var chkitem = $(this);
                        if (chkitem[0].checked) {
                            if (chkitem[0].id == chklst[0].id) {
                                checkedValues.push(chkitem.val() + '：' + txt.val());
                            } else {
                                checkedValues.push(chkitem.val());
                            }
                        }
                    });
                    txt1st.val(checkedValues.join(','));
                });
            });
        });
    }

    function setSingleChk() {
        var block = $('#cpt_assess_form .singleChk');
        block.each(function () {
            var $block = $(this);
            var group = $block.find('.groupChk');
            var chk = $(this).find('input:checkbox');
            chk.each(function () {
                //console.log("單選");
                var item = $(this);
                var setChkDefault = function (pChk, chked) {
                    pChk.each(function () {
                        var $item = $(this);
                        $item[0].checked = false;
                    });
                    chked[0].checked = true;
                };
                item.unbind('click').click(function () {
                    if (item[0].checked) {
                        group.each(function () {
                            var chk1 = $(this).find('input:checkbox').first();
                            var chk = $(this).find('input:checkbox').not('.firstChk');
                            var txt = $(this).find('input:text');
                            chk1.each(function () {
                                var gItem = $(this);
                                if (item[0].value != gItem[0].value) {
                                    txt.each(function () {
                                        $(this).val('');
                                    });
                                    chk.each(function () {
                                        var $chk = $(this);
                                        $chk[0].checked = false;
                                    });
                                }
                            });
                        });
                        setChkDefault(chk, item);
                    }
                });
            });
            group.each(function () {
                var $group = $(this);
                var txt = $(this).find('input:text');
                txt.each(function () {
                    var item = $(this);
                    item.unbind('keyup').keyup(function () {
                        var val = $(this).val();
                        chk.each(function () {
                            $(this)[0].checked = false;
                        });
                        group.not($group).each(function () {
                            var $txt = $(this).find('input:text');
                            $txt.each(function () {
                                $(this).val('');
                            });
                        });
                        $(this).val(val);
                    });
                });
            });
        });
    }

    function setGroupChk() {
        $('#cpt_assess_form .groupChk').each(function () {
            var chk1 = $(this).find('input[type=checkbox]:first');
            var chk = $(this).find('input:checkbox').not('.firstChk');
            var txt = $(this).find('input:text');

            chk1.each(function () {
                var item = $(this);
                item.unbind('click').click(function () {
                    var $chk = $(this);
                    if (!chk1[0].checked) {
                        txt.each(function () {
                            $(this).val('');
                        });
                        chk.each(function () {
                            var $chk = $(this);
                            $chk[0].checked = false;
                        });
                    }
                });
            });
            chk.each(function () {
                var item = $(this);
                item.unbind('click').click(function () {
                    var $chk = $(this);

                    if ($chk[0].checked) {
                        chk1[0].checked = true;
                        chk.each(function () {
                            var chkitem = $(this);
                            if (chkitem[0].checked) {
                                noChk = false;
                            }
                        });
                    } else {
                        var noChk = true;
                        chk.each(function () {
                            var chkitem = $(this);
                            if (chkitem[0].checked) {
                                noChk = false;
                            }
                        });
                        if (noChk) {
                            chk1[0].checked = false;
                        }
                    }
                });
            });
            txt.each(function () {
                var item = $(this);
                item.unbind('keyup').keyup(function () {
                    var $txt = $(this);
                    var val = $txt[0].value;
                    if ($txt[0].value != '') {
                        chk1[0].checked = true;

                    } else {
                        chk1[0].checked = false;
                    }
                });
                item.unbind('change').change(function () {
                    var $txt = $(this);
                    if ($txt[0].value != '') {
                        chk1[0].checked = true;
                    } else {
                        chk1[0].checked = false;
                    }
                });
            });
        });
    }


    //////////////////   待移除
    $("#cpt_assess_form .keyreal").off('change').on('change', function () {
        var re_p = new RegExp("^[0-9]+(.[0-9]{1,5})?$", "g");
        var re_n = new RegExp("^\-[0-9]+(.[0-9]{1,5})?$", "g");
        if (!re_p.test($(this).val()) && !re_n.test($(this).val())) {
            if ($(this).val() != "") {
                alert("數量格式錯誤");
                $(this).val("");
                $(this).focus();
            }
        }
    })

    ////CXR 繪圖、日期清空
    //function RestXYs() {
    //    var ctx = $canvas[0].getContext("2d");
    //    ctx.clearRect(0, 0, $canvas.width(), $canvas.height());
    //    cxr_xys = [];
    //    resetCXR();
    //}

    ////CXR 重繪
    //function ReplyDrawCxr(json_xys) {
    //    var xys = JSON.parse(json_xys);
    //    for (var i = 0; i < xys.length ; i++) {
    //        DrawCxr(xys[i]["x"], xys[i]["y"], xys[i]["width"]);
    //    }
    //}

    ////CXR List重繪
    //function ViewReplyDrawCxr(canvas_id, json_xys) {

    //    var xys = "";
    //    if (json_xys != "" && typeof json_xys != "undefined") {
    //        xys = JSON.parse(json_xys);
    //    }

    //    setTimeout(function () {
    //        ViewDrawImg(canvas_id);
    //        for (var i = 0; i < xys.length ; i++) {
    //            ViewDrawCxr(canvas_id, xys[i]["x"], xys[i]["y"], xys[i]["width"]);
    //        }
    //    }, 100);

    //}

    ////CXR List繪製
    //function ViewDrawCxr(canvas_id, x, y, width) {
    //    var $canvas = $("#" + canvas_id);
    //    var circle_size = width;
    //    //圓形
    //    var ctx = $canvas[0].getContext("2d");
    //    var circle = new Path2D();
    //    circle.arc(x, y, circle_size, 0, 2 * Math.PI);
    //    ctx.fillStyle = "gray";
    //    ctx.fill(circle);
    //    //記錄座標
    //    xy_obj = {
    //        x: x,
    //        y: y,
    //        width: width
    //    };
    //    cxr_xys.push(xy_obj);
    //}

    ////CXR 繪製
    //function DrawCxr(x, y, width) {
    //    //console.log(x+","+y);
    //    var circle_size = width;
    //    //圓形
    //    var ctx = $canvas[0].getContext("2d");
    //    var circle = new Path2D();
    //    circle.arc(x, y, circle_size, 0, 2 * Math.PI);
    //    ctx.fillStyle = "gray";
    //    ctx.fill(circle);
    //    //記錄座標
    //    xy_obj = {
    //        x: x,
    //        y: y,
    //        width: width
    //    };
    //    cxr_xys.push(xy_obj);
    //}

    ////canvas點選、放開按鍵事件時進行繪圖動作
    //$canvas.mousedown(function (e) {
    //    var rect = this.getBoundingClientRect();
    //    var x = e.clientX - rect.left;
    //    var y = e.clientY - rect.top;
    //    if (type_mode != "H") {
    //        DrawCxr(x, y, $("#pen_width").html());
    //    }
    //});

    //function resetCXR() {
    //    var block = $('.div_CXR_detail');
    //    var chk = $(block).find('input:checkbox');
    //    var txt = $(block).find('input:text');
    //    chk.each(function () {
    //        var item = $(this);
    //        if (item[0].checked)
    //            item[0].checked = false;
    //    });
    //    txt.each(function () {
    //        $(this).val('');
    //    });
    //    var ctx = $canvas[0].getContext("2d");
    //    ctx.clearRect(0, 0, $('#cpt_assess_form').width(), $('#cpt_assess_form').height());
    //    ViewDrawImg("Result_XYs");
    //    cxr_xys = [];
    //}

    //function showCXR(obj) {
    //    if (type_mode == "H") {
    //        return false;
    //    }
    //    $('#div_modify_CXR').modal('show');
    //    resetCXR();
    //    var rid = $(obj).attr('Rid');
    //    if (rid != "" && typeof rid != "undefined") {
    //        $("#CXR_ID").val(rid);
    //        var ridno = parseInt(rid);
    //        var txt = $('#CXR_result_json').val();
    //        var JsonList = JSON.parse(txt);
    //        var block = $('.div_CXR_detail');
    //        $(block).find('#Result_Date').val(JsonList[ridno].Result_Date);
    //        $(block).find('#image_file_key').val(JsonList[ridno].image_file_key);
    //        $(block).find('#Result_Str').val(JsonList[ridno].Result_Str);
    //        var Canvas_Id = $(block).find('canvas')[0].id;
    //        ViewReplyDrawCxr(Canvas_Id, JsonList[ridno].Result_XYs);
    //    } else {
    //        $("#CXR_ID").val(0); //201603031414 Henry限定只有一項
    //    }
    //}

    //function delCXR() {
    //    if ($('#CXR_result_json').val() == '') {
    //    }
    //    else {
    //        var ridno = parseInt($('#CXR_ID').val());
    //        var txt = $('#CXR_result_json').val();
    //        var JsonList = JSON.parse(txt);
    //        JsonList.splice(ridno, 1);
    //        $('#CXR_result_json').val(JSON.stringify(JsonList));
    //        if ($('#CXR_result_json').val() == '[]')
    //            $('#CXR_result_json').val('');
    //    }
    //    $('#div_modify_CXR').modal('hide');
    //    CXR_build();
    //}

    //function modifyCXR() {
    //    var block = $('.div_CXR_detail');
    //    var arr = new Array();
    //    var obj = new Object;
    //    obj["Result_XYs"] = JSON.stringify(cxr_xys).trim();
    //    obj["Result_Str"] = $(block).find("#Result_Str").val();
    //    obj["image_file_key"] = $(block).find("#image_file_key").val();
    //    obj["Result_Date"] = $(block).find("#Result_Date").val();
    //    var txtlast = $(block).find('input:text').last();
    //    //var txt = $(block).find('input:text').not(txtlast);
    //    //txt.each(function () {
    //    //    obj[$(this)[0].id] = $(this).val();
    //    //});
    //    arr = arr.concat(obj);
    //    $('#CXR_json').val(JSON.stringify(arr).trim());
    //    if ($('#CXR_result_json').val() == '') {
    //        $('#CXR_result_json').val($('#CXR_json').val());
    //    }
    //    else {
    //        var ridno = parseInt($('#CXR_ID').val());
    //        var txt = $('#CXR_result_json').val();
    //        var JsonList = JSON.parse(txt);
    //        JsonList.splice(ridno, 1, obj);
    //        $('#CXR_result_json').val(JSON.stringify(JsonList));
    //    }
    //    $('#div_modify_CXR').modal('hide');
    //    CXR_build();
    //}

    //function CXR_build() {
    //    if ($('#CXR_result_json').val() == '') {
    //        $('#CXR_table td').remove();
    //    }
    //    else {
    //        $('#CXR_table td').remove();
    //        var txt = $('#CXR_result_json').val();
    //        var JsonList = JSON.parse(txt);
    //        for (var i = 0; i < JsonList.length; i++) {
    //            if (i > 0) break;//201603031414 Henry限定只有一項
    //            var temp = '<td Rid="' + i + '" onclick="showCXR(this);">';
    //            $('#CXRdate').append(temp + JsonList[i].Result_Date + '</td>');
    //            var Result_Str = JsonList[i].Result_Str == "" ? "" : "結果:" + JsonList[i].Result_Str;
    //            var Canvas_Id = 'Show_Result_XYs_' + i;
    //            var Canvas_Block = '<canvas class="result_canvas" id="' + Canvas_Id + '" name="' + Canvas_Id + '" width="120" height="120" />';
    //            $('#CXRresult').append(temp + Canvas_Block + "</br>" + Result_Str + '</td>');
    //            ViewReplyDrawCxr(Canvas_Id, JsonList[i].Result_XYs);
    //            $('#CXRcaption').append(temp + JsonList[i].Result_Str + '</td>');
    //        }
    //    }
    //}

    function ctpsetzerofix() {
        var block = $("#cpt_assess_form .cptzerofix");
        block.each(function () {
            var txt = $(this).find('input:text').not('.abgitem');
            txt.each(function () {
                var item = $(this);
                item.blur(function () {
                    var txt1 = $(this);
                    if ($.isNumeric(txt1.val())) {
                        var number = parseFloat(txt1.val());
                        if (number == 0) {
                            txt1.val('');
                        }
                        else {
                            if (txt1.val().indexOf('.') != -1)
                                txt1.val((number >= 0 ? Math.floor(number * Math.pow(10, 1)) / Math.pow(10, 1) : Math.ceil(number * Math.pow(10, 1)) / Math.pow(10, 1)).toFixed(1));
                            else
                                txt1.val(number.toString());
                        }
                    }
                    else {
                    }
                });
                if ($.isNumeric(item.val())) {
                    var number = parseFloat(item.val());
                    if (number == 0) {
                        item.val('');
                    }
                    else {
                        if (item.val().indexOf('.') != -1)
                            txt1.val((number >= 0 ? Math.floor(number * Math.pow(10, 1)) / Math.pow(10, 1) : Math.ceil(number * Math.pow(10, 1)) / Math.pow(10, 1)).toFixed(1));
                        else
                            item.val(number.toString());
                    }
                }
            });
        });
    }

    //$("#cpt_assess_form .keylimitint").bind('blur.keylimitint', function () {
    //    var re;
    //    var txt = $(this).attr('id').split('_');
    //    var checkv = txt[2];
    //    var limitre = function (minv, maxv) {
    //        return new RegExp("^[" + minv + "-" + maxv + "]$");
    //    };
    //    switch (checkv) {
    //        case "e":
    //            re = limitre(1, 4);
    //            break;
    //        case 'v':
    //            re = limitre(1, 5);
    //            break;
    //        case 'm':
    //            re = limitre(1, 6);
    //            break;
    //        default:
    //            re = /^\d+$/;
    //    }
    //    if (!re.test($(this).val())) {
    //        if ($(this).val() != "") {
    //            alert("數量格式錯誤");
    //            $(this).val("");
    //            $(this).focus();
    //        }
    //    }
    //})

    function SetDateTimeNow(obj) {
        var Today = new Date();
        if (obj.attr('id').indexOf('date') != -1) {
            obj.val(Today.getFullYear() + "-" + (Today.getMonth() + 1) + "-" + Today.getDate());
        }
        if (obj.attr('id').indexOf('time') != -1) {
            obj.val(Today.getHours() + "-" + Today.getMinutes());
        }
        obj.datetimepicker('update', obj.val());
    }

    $(document).ready(function () {
        maya_datetimepicker($(".dt-picker"));

        $("#cpt_record_panel").modal("show");


        if (($('#cpt_ass_ipd_bed').val() == null || $('#cpt_ass_ipd_bed').val() == '') && $('#cpt_ass_ipd_bed > option').length > 1) {
            $("#cpt_ass_ipd_bed")[0].selectedIndex = 1;
        }

        // step1
        $("#div_sound input[name=ck_sound]").unbind("click").click(function () {
            if ($(this).prop("checked") == false && $(this).val() != "Clear" && $(this).val() != "Stridor") {
                $("input[name=" + $(this).attr("id") + "]").prop("checked", false);
            }
        });

        // step2
        $("#div_sound input[name!=ck_sound][type=checkbox]").unbind("click").click(function () {
            var name = $(this).attr("name");
            if ($("input[name=" + name + "]:checked").length > 0 && name != "ck_sound")
                $("#" + name).prop("checked", true);
            else
                $("#" + name).prop("checked", false);
        });

        setRule();

        $("#pen_size").slider({
            value: 4,
            min: 1, max: 8,
            change: function (a, ui) {
                $("#pen_width").html(ui.value);
            }
        });

        // 讀取資料
        get_cpt_data('@CPT_id', '@temp_cpt_date');
        HideNewAssessOption(true);

        // 綁定可編輯下拉
        $("#cpt_form .editable_select").each(function () {
            $(this).editableSelect({
                effects: 'slide',
                filter: false,
                appendTo: $('#cpt_form'),
                onSelect: function (element) {
                    $(this).trigger("keyup");
                }
            });
        });

        // 綁定可編輯下拉
        $("#cpt_record_panel .editable_select").each(function () {
            $(this).editableSelect({
                effects: 'slide',
                filter: false,
                appendTo: $('#cpt_record_panel'),
                onSelect: function (element) {
                    $(this).trigger("keyup");
                }
            });
        });

        // 綁定可編輯下拉
        $("#div_modify_CXR .editable_select").each(function () {
            $(this).editableSelect({
                effects: 'slide',
                filter: false,
                appendTo: $('#div_modify_CXR'),
                onSelect: function (element) {
                    $(this).trigger("keyup");
                }
            });
        });
        //設定checkBox規則
        setcheckboxRules('cpt_assess_form');
        //特殊處裡
        //抽菸史 ==START==
        //1.勾選已戒菸，抽菸史必須是"有"
        $('#cpt_assess_form #cpt_ass_smoke_history_5').click(function () {
            if (this.checked) $('#cpt_assess_form #cpt_ass_smoke_history_2').prop('checked', true);
        });
        $('#cpt_assess_form #cpt_ass_smoke_history_6').keyup(function () {
            if ($(this).val() != '') $('#cpt_assess_form #cpt_ass_smoke_history_2').prop('checked', true);
        });
        //2.抽菸史"有"清空後，已戒菸也要清空
        $('#cpt_assess_form #cpt_ass_smoke_history_2').click(function () {
            if (!this.checked) {
                $('#cpt_assess_form #cpt_ass_smoke_history_5').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_smoke_history_6').val('');
            }
        });
        $('#cpt_assess_form #cpt_ass_sputum_ass_16').click(function () {
            if (this.checked) {
                $('#cpt_assess_form #cpt_ass_sputum_ass_4').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_sputum_ass_5').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_sputum_ass_8').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_sputum_ass_9').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_sputum_ass_10').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_sputum_ass_11').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_sputum_ass_17').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_sputum_ass_12').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_sputum_ass_13').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_sputum_ass_14').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_sputum_ass_15').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_sputum_ass_7').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_sputum_ass_18').prop('checked', false);
            }
        });
        $('#cpt_assess_form .txt_smoke_1').keyup(function () {
            var hasTxt = false;
            $('#cpt_assess_form .txt_smoke_1').each(function () {
                if ($(this).val() != '') hasTxt = true;
            });
            if (!hasTxt) {
                $('#cpt_assess_form #cpt_ass_smoke_history_5').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_smoke_history_6').val('');
            }
        });
        //抽菸史 ==END==
        //人工氣道 ==START==
        //E-T Tube需填Size及Position，Tracheostomy只需填Size
        $('#cpt_assess_form #rb_tube_block').find('input:checkbox').click(function () {
            //如果取消則清空資料
            var clearTxt = function () {
                $('#cpt_assess_form #rb_tube_block').find('input:text').each(function () {
                    $(this).val('');
                });
            }
            switch ($(this).attr('id')) {
                case 'cpt_ass_tube_1':
                    clearTxt();
                    break;
                case 'cpt_ass_tube_3':
                    if (this.checked) $('#cpt_assess_form input[name=txt_tube_position]').val('');
                case 'cpt_ass_tube_2':
                    if (!this.checked) clearTxt();
                    break;
                default:
                    break;

            }
        });
        //檢查是否有key資料
        $('#cpt_assess_form #rb_tube_block').find('input:text').keyup(function () {
            var bothNoTxt = true;
            var noTxt = false;
            var hasPositionTxt = false;
            //檢查txt是否有資料
            $('#cpt_assess_form #rb_tube_block').find('input:text').each(function () {
                if ($(this).val() == '') noTxt = true;
                if ($(this).attr('name') == 'txt_tube_position' && $(this).val() != '') hasPositionTxt = true;
                if ($(this).val() != '') {
                    bothNoTxt = false;
                    $('#cpt_assess_form #cpt_ass_tube_1').prop('checked', false);
                }
            });
            //如果txt都有資料，E-T Tube自動勾選
            //sPosition有資料，E-T Tube自動勾選
            if (!noTxt || hasPositionTxt) {
                $('#cpt_assess_form #rb_tube_block').find('input:checkbox').chkAllBox(false);
                $('#cpt_assess_form #cpt_ass_tube_2').prop('checked', true);
            }
            //如果都沒有資料，清空checkbox
            if (bothNoTxt) {
                $('#cpt_assess_form #cpt_ass_tube_2').prop('checked', false);
                $('#cpt_assess_form #cpt_ass_tube_3').prop('checked', false);
            }
        });
        //人工氣道 ==END==
        //設定是否唯讀
               @if (string.IsNullOrWhiteSpace(CPT_id) || ViewBag.edit)
        {
            @:setRecodRule("#cpt_form", true, type_mode);
        }
        else
        {
            @:setRecodRule("#cpt_form", false, type_mode);

        }
        // set_readonly("#cpt_form");

    });

    function onkeyup_Textarea_Count(show_id, value_id) {
        if (!!$('#' + value_id).val()) {
            $('#' + show_id).text($('#' + value_id).val().length);
        } else {
            $('#' + show_id).text('');
        }

    }

    //PBW
    function PBW() {
        var pbw = '';
        if ($('#now_patient #now_pat_gender').html() == '女') {
            pbw = (0.6 * (parseInt($('#cpt_record_body #body_height').val()) - 70)).toFixed(2)
        }
        if ($('#now_patient #now_pat_gender').html() == '男') {
            pbw = (0.7 * (parseInt($('#cpt_record_body #body_height').val()) - 80)).toFixed(2)
        }
        $('#cpt_record_body #f_body_weight').val(pbw);
        return false;
    }

    // 列印病例首頁
    function print_cpt(btn_obj, id) {

        if ($("#cpt_ass_ipd_bed").val() === "") {
            showAlert("無資料可印", msg_stat.Warning);
            return;
        }

        isPrintSumit = true;
        btn_obj.attr("disabled", true);
        win = window.open('about:blank', 'TheNewWindow');
        $.ajax({
            url: '@Url.Content("~/CPT/cpt_page")',
            data: { cpt_id: id },
            type: 'POST',
            success: function (data) {
                $("#cpt_pdf_form #HtmlStrCXR2").val(data);
                $("#cpt_pdf_form")[0].submit();
            },
            error: function (jqXHR) {
                log(jqXHR);
                btn_obj.attr("disabled", false);
            },
            complete: function () {
                btn_obj.attr("disabled", false);
            }
        });
    }
</script>

