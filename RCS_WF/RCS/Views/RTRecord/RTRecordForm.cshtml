@model RCS_Data.Models.ViewModels.RT_RECORD_MAIN
@using RCS_Data;
@using RCS.Models;
@{
    int tableIndex = 0;
    UserInfo user_info = (UserInfo)Session["user_info"];
    // 呼吸器財產編號 & 呼吸器型號
    RESP_COLLECTION resp_list = (RESP_COLLECTION)ViewData["resp_list"];
    // 所有需要用的到的系統參數
    SysParamCollection sys_params_list = (SysParamCollection)ViewData["sys_params_list"];
    List<SelectListItem> mySelectItems = new List<SelectListItem>();
    IPDPatientInfo pat_info = (IPDPatientInfo)ViewData["pat_info"]; 
    bool VIPtag = (bool)ViewData["VIPtag"];
    string RECORDData = (string)ViewData["RECORDData"];
    IPDPatientInfo patInfo = (IPDPatientInfo)ViewData["pat_info"];
    string RecordID_GetStr = string.IsNullOrWhiteSpace(Model.RECORD_ID) ? "" : Model.RECORD_ID.ToString().Trim();
}

<style type="text/css">
     #cxr_modal .input-group { /*右欄位1~4標題*/
        margin: 0.5em 0;
    }
 

    #cxr_modal .ColorOptions { /*2018.08.26 線繪圖*/
        float: left;
        width: 20px;
        height: 20px;
        border: 2px solid #cccccc;
        margin-left: 5px;
        margin-top: 0px;
        text-align: center;
        vertical-align: middle;
    }
    #cxr_modal .BlackBorder {  
        border: 2px solid black;
    }

    #cxr_modal .RtRecordCanvasCls:hover + .myCanvasCursorCls {
        opacity: 1;
    }
    
    #cxr_modal .v-select.single .selected-tag + input[type="search"] {
        /*--- v-select height 換行，自身Bug內建錯誤修正 h-ttps://github.com/sagalbot/vue-select/pull/512---*/
        padding: 0;
        width: 0px !important;
    }

    #rt_record_panel .modal-body .panel-rightbody > div[class*=col] {
        padding: 2px;
    }


    #rt_record_panel .list_span {
        margin: 5px;
    }

    #rt_record_panel .panel_head, .showSwitch {
        cursor: pointer;
    }
</style>

<div class="modal fade col-lg-12 col-xs-12" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" id="rt_record_panel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h5 class="btn-group col-md-4 col-xs-6">
                        病歷號：<label id="record_form_pat_chart_no">@Html.Raw(patInfo.chart_no)</label>&emsp;&emsp;
                        姓名：<label id="record_form_pat_name">@Html.Raw(patInfo.patient_name)</label>&emsp;&emsp;
                        床號：<label id="record_form_bed_no">@Html.Raw(patInfo.bed_no)</label>&emsp;&emsp;
                        <span style="display:none;">
                            醫師：@Html.DropDownListFor(x => x.custom_vs_doc, sys_params_list.getGroupList("Shared", "doctor_name"), "")
                        </span>
                    </h5>
                    <div class="col-md-8 col-xs-8" style="padding: 10px 15px;">
                        <div class="btn-group pull-right">
                            <div class="btn-group " id="RTRECORD_FUNC" >
                                <button class="btn btn-info dropdown-toggle" type="button" data-toggle="dropdown" chktype>
                                    功能
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" id="RWAC_FUNC">
                                    <li><a href="#" onclick="RWAC_vm.openData($('#now_patient').attr('chart_no'), $('#now_patient').attr('ipd_no'));"><i class="fas fa-list"></i>&nbsp;每日呼吸器脫離評估</a></li>
                                    <li><a class="exec-func" href="#" data-func="showLabALLData" data-loading-text="取得中..." chktype><span class="glyphicon glyphicon-zoom-in"></span>&nbsp;取得檢驗資料</a></li> 
                                    <li><a href="#" onclick="work_panel_vm.open();"><i class="glyphicon glyphicon-list-alt"></i>&nbsp;統計註記</a></li>
                                </ul>
                            </div> 
                            <button class="btn btn-default exec-func" data-func="getBreathList" data-loading-text="帶入中..." chktype><i class="fas fa-info-circle"></i>&nbsp;呼吸器紀錄</button>
                            <button class="btn btn-primary exec-func" data-func="last_data" data-loading-text="帶入中..." chktype><span class="glyphicon glyphicon-text-height"></span>&nbsp;帶入最後一筆</button>
                            @if (!string.IsNullOrWhiteSpace(RecordID_GetStr))
                            {
                                <button class="btn btn-danger exec-func" data-func="delete" data-loading-text="刪除中..." delType><span class="glyphicon glyphicon-remove-sign"></span>&nbsp;刪除</button>

                            }
                            <button class="btn btn-success exec-func" data-func="save" data-loading-text="儲存中..." chktype><span class="glyphicon glyphicon-save"></span>&nbsp;確定</button>
                            <button class="btn btn-warning" data-dismiss="modal" notlock><span class="glyphicon glyphicon-folder-close"></span>&nbsp;關閉</button>
                        </div>
                    </div>
                </div>
                <p class="clearfix"></p>
            </div>
            <div class="modal-body row">
                <form id="rt_record_form">
                    <div class="col-lg-12 col-xs-12" id="plugin_data_panel"> 
                            <div class="col-lg-3 col-xs-3  list-group-item-text">
                                <div class="list_span">
                                    <i class="fa fa-bookmark" aria-hidden="true">&ensp;使用儀器&ensp;</i>
                                    <span class="pull-right"> 
                                        <input type="checkbox" style="display:none;">
                                    </span>
                                </div>
                            </div>
                            <div class="col-lg-3 col-xs-3 list-group-item list-group-item-warning">
                                <div class="list_span switch" id="intubate_switch">
                                    <i class="panel-title pull-left" aria-label="intubate" aria-hidden="true">&ensp;插管&emsp;</i>
                                    <span class="pull-right" style="margin-bottom:4px;">
                                        @*<i class="bootstrapSwitch fas fa-toggle-off fa-1x" id="intubate_switch"></i>*@                                        
                                        @*<input type="checkbox" class="bootstrapSwitch" data-on-color="warning" data-size="mini" aria-label="intubate" >*@ 
                                        <input type="checkbox" data-on-text="ON" data-off-text="OFF" data-size="mini" />
                                    </span>
                                </div>
                            </div>
                            <div class="col-lg-3 col-xs-3 list-group-item list-group-item-success">
                                <div class="list_span switch" id="breath_switch">
                                    <i class="panel-title pull-left" aria-label="breath" aria-hidden="true">&ensp;呼吸器&emsp;</i>
                                    <span class="pull-right" style="margin-bottom:4px;">
                                        @*<i class="bootstrapSwitch fas fa-toggle-off fa-1x" id="breath_switch"></i>*@
                                        @*<input type="checkbox" class="bootstrapSwitch" data-on-color="success" data-size="mini" aria-label="breath" >*@
                                        <input type="checkbox" data-on-text="ON" data-off-text="OFF" data-size="mini" />
                                    </span>
                                </div>
                            </div>
                            <div class="col-lg-3 col-xs-3 list-group-item list-group-item-info">
                                <div class="list_span switch" id="oxygen_switch">
                                    <i class="panel-title pull-left oxygen" aria-label="oxygen" aria-hidden="true">&ensp;氧療&emsp;</i>
                                    <span class="pull-right" style="margin-bottom:4px;">
                                        @*<i class="bootstrapSwitch fas fa-toggle-off fa-1x" id="oxygen_switch"></i>*@
                                        @*<input type="checkbox" class="bootstrapSwitch" data-on-color="info" data-size="mini" aria-label="oxygen">*@
                                        <input type="checkbox" data-on-text="ON" data-off-text="OFF" data-size="mini" />
                                    </span>
                                </div>
                            </div>
                            <!-- 插管、呼吸器、氧療 -->
                            <div id="intubateDataPanel" class="DataPanel col-lg-12 col-xs-12 panel panel-warning" data-source="on_intubate">  
                            </div>
                            <div id="breathDataPanel" class="DataPanel col-lg-12 col-xs-12 panel panel-success" data-source="on_breath">  
                            </div>
                            <div id="oxygenDataPanel" class="DataPanel col-lg-12 col-xs-12 panel panel-info" data-source="on_oxygen">  
                            </div> 
                    </div>
                    <div class="col-lg-12 col-xs-12">

                        <!-- 呼吸治療記錄單 -->
                        <span class="hidden" id="rt_record_form_master_panel">

                            <input type="hidden" class="form-control" data-rcs-cate="isVIP" id="isVIP" name="isVIP" value="">
                            <input type="hidden" class="form-control" data-rcs-cate="DATASTATUS" id="DATASTATUS" name="DATASTATUS" value="">
                            <input type="hidden" class="form-control" data-rcs-cate="UPLOAD_STATUS" id="UPLOAD_STATUS" name="UPLOAD_STATUS" value="">
                            <input type="hidden" class="form-control" data-rcs-cate="lastONMODE_TYPE_ID" id="lastONMODE_TYPE_ID" name="lastONMODE_TYPE_ID" value="">
                            <input type="hidden" class="form-control" data-rcs-cate="CREATE_ID" id="CREATE_ID" name="CREATE_ID" value="">
                            <input type="hidden" class="form-control" data-rcs-cate="RECORD_ID" id="RECORD_ID" name="RECORD_ID" value="">
                            <input type="hidden" class="form-control" data-rcs-cate="ONMODE_TYPE1_ID" id="ONMODE_TYPE1_ID" name="ONMODE_TYPE1_ID" value="">
                            <input type="hidden" class="form-control" data-rcs-cate="ONMODE_TYPE2_ID" id="ONMODE_TYPE2_ID" name="ONMODE_TYPE2_ID" value="">
                            <input type="hidden" class="form-control" data-rcs-cate="ONMODE_TYPE3_ID" id="ONMODE_TYPE3_ID" name="ONMODE_TYPE3_ID" value="">
                        </span>
                        <div class="panel panel-default" data-source="rt_record" id="rt_record_form_panel">
                            <input type="hidden" class="form-control" data-rcs-cate="work_data" id="work_data" name="work_data" value="">
                            <div class="panel-heading">
                                <input type="hidden" class="form-control" data-rcs-cate="CXR_result_json" id="CXR_result_json" name="CXR_result_json" value="">
                                呼吸治療記錄單
                                <label data-rcs-cate="weaning" for="weaning" class="btn btn-danger form-block pull-right" style="margin-top:-5px;">
                                    嘗試脫離狀態
                                    <input type="checkbox" id="weaning" name="weaning" class="badgebox" data-rcs-value="1"><span class="badge">&check;</span>
                                </label>
                            </div>
                            <div class="panel-body panel-rt-record row">
                                <div class="col-lg-12 col-md-12 panel panel-success panel-side">
                                    <div class="panel-leftheading bg-success">
                                        
                                    </div>
                                    <div class="panel-rightbody">
                                        <div class="col-md-6">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-addon">記錄日期</span>
                                                <input type="text" class="form-control dt-picker" data-rcs-cate="recorddate" dt-format="d" id="recorddate" name="recorddate" tabindex="@(tableIndex++)" readonly />
                                            </div>
                                        </div>
                                        <!-- 記錄單時間 -->
                                        <div class="col-md-6">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-addon">記錄時間</span>
                                                <input type="text" class="form-control dt-picker" data-rcs-cate="recordtime" dt-format="t" id="recordtime" name="recordtime" tabindex="@(tableIndex++)" readonly />
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-addon">呼吸器編號</span>
                                                <select type="select" class="form-control get_last hasMode hasBreah" data-rcs-cate="respid" id="respid" name="respid" tabindex="@(tableIndex++)">
                                                    <option value=""></option>
                                                    @foreach (DeviceMaster item in resp_list)
                                                    {
                                                        if (string.IsNullOrWhiteSpace(item.USE_STATUS) || item.USE_STATUS == "N")
                                                        {
                                                            <option value="@(item.field_value)" style="background-color: #EEEEEE">@(item.DEVICE_NO)(停用)</option>
                                                        }
                                                        else if (string.IsNullOrWhiteSpace(item.ROOM))
                                                        {
                                                            <option value="@(item.field_value)">@(item.DEVICE_NO)</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@(item.field_value)" style="background-color: #C8EEFA">@(item.DEVICE_NO)</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clearfix">
                                    </div>
                                </div>
                                <div class="col-lg-12 col-md-12 panel panel-success panel-side">
                                    <div class="panel-leftheading bg-success">
                                        呼吸器設定參數
                                    </div>
                                    <div class="panel-rightbody">
                                        <div class="col-md-6 panel-body">
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon form-block">
                                                        Ventilator Type
                                                    </span>
                                                    @{
                                                        var _device = sys_params_list.get_group_list("Index_device", "device_model");
                                                        _device.Clear();
                                                        _device.Add(new SysParams() { P_VALUE = "Airvo 2", P_NAME = "Airvo 2" });
                                                        _device.Add(new SysParams() { P_VALUE = "C1", P_NAME = "C1" });
                                                        _device.Add(new SysParams() { P_VALUE = "EvitaXL", P_NAME = "EvitaXL" });
                                                        _device.Add(new SysParams() { P_VALUE = "Evita2dura", P_NAME = "Evita2dura" });
                                                        _device.Add(new SysParams() { P_VALUE = "Evita4", P_NAME = "Evita4" });
                                                        _device.Add(new SysParams() { P_VALUE = "Galileo", P_NAME = "Galileo" });
                                                        _device.Add(new SysParams() { P_VALUE = "Infant Star", P_NAME = "Infant Star" });
                                                        _device.Add(new SysParams() { P_VALUE = "NPV", P_NAME = "NPV" });
                                                        _device.Add(new SysParams() { P_VALUE = "Savina", P_NAME = "Savina" });
                                                        _device.Add(new SysParams() { P_VALUE = "Sechrist", P_NAME = "Sechrist" });
                                                        _device.Add(new SysParams() { P_VALUE = "Servo i", P_NAME = "Servo i" });
                                                        _device.Add(new SysParams() { P_VALUE = "Servo 900C", P_NAME = "Servo 900C" });
                                                        _device.Add(new SysParams() { P_VALUE = "Servo-S", P_NAME = "Servo-S" });
                                                        _device.Add(new SysParams() { P_VALUE = "SLE", P_NAME = "SLE" });
                                                        _device.Add(new SysParams() { P_VALUE = "Stellar", P_NAME = "Stellar" });
                                                        _device.Add(new SysParams() { P_VALUE = "Synchrony", P_NAME = "Synchrony" });
                                                        _device.Add(new SysParams() { P_VALUE = "T-bird", P_NAME = "T-bird" });
                                                        _device.Add(new SysParams() { P_VALUE = "VELA", P_NAME = "VELA" });
                                                        _device.Add(new SysParams() { P_VALUE = "VIP-Bird", P_NAME = "VIP-Bird" });
                                                        _device.Add(new SysParams() { P_VALUE = "VPAP", P_NAME = "VPAP" });
                                                        _device.Add(new SysParams() { P_VALUE = "300C", P_NAME = "300C" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("device", new SelectList(_device, "P_VALUE", "P_NAME"), "", new { @class = "form-control editable_select get_last", @tabindex = tableIndex++, @maxlength = "30", @data_rcs_cate = "device", @type = "select" })
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Ventilation Mode</span>
                                                    @{
                                                        var _mode = sys_params_list.get_group_list("Index_device", "mode");
                                                        _mode.Clear();
                                                        _mode.Add(new SysParams() { P_VALUE = "VC/AC", P_NAME = "VC/AC" });
                                                        _mode.Add(new SysParams() { P_VALUE = "PC/AC", P_NAME = "PC/AC" });
                                                        _mode.Add(new SysParams() { P_VALUE = "PRVC/AC", P_NAME = "PRVC/AC" });
                                                        _mode.Add(new SysParams() { P_VALUE = "VC/SIMV+PS", P_NAME = "VC/SIMV+PS" });
                                                        _mode.Add(new SysParams() { P_VALUE = "PC/SIMV+PS", P_NAME = "PC/SIMV+PS" });
                                                        _mode.Add(new SysParams() { P_VALUE = "PRVC/SIMV+PS", P_NAME = "PRVC/SIMV+PS" });
                                                        _mode.Add(new SysParams() { P_VALUE = "PSV", P_NAME = "PSV" });
                                                        _mode.Add(new SysParams() { P_VALUE = "CPAP", P_NAME = "CPAP" });
                                                        _mode.Add(new SysParams() { P_VALUE = "S/T", P_NAME = "S/T" });
                                                        _mode.Add(new SysParams() { P_VALUE = "NIV/PC", P_NAME = "NIV/PC" });
                                                        _mode.Add(new SysParams() { P_VALUE = "NIV/PS", P_NAME = "NIV/PS" });
                                                        _mode.Add(new SysParams() { P_VALUE = "HFNC", P_NAME = "HFNC" });
                                                        _mode.Add(new SysParams() { P_VALUE = "APRV", P_NAME = "APRV" });
                                                        _mode.Add(new SysParams() { P_VALUE = "Bivent", P_NAME = "Bivent" });
                                                        _mode.Add(new SysParams() { P_VALUE = "BiPAP", P_NAME = "BiPAP" });
                                                        _mode.Add(new SysParams() { P_VALUE = "T-piece", P_NAME = "T-piece" });
                                                        _mode.Add(new SysParams() { P_VALUE = "Collar", P_NAME = "Collar" });
                                                        _mode.Add(new SysParams() { P_VALUE = "HFOV", P_NAME = "HFOV" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("mode", new SelectList(_mode, "P_VALUE", "P_NAME"), "", new { @class = "form-control editable_select get_last", @tabindex = tableIndex++, @maxlength = "30", @data_rcs_cate = "mode", @type = "select", @id = "mode" })
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon"> O<sub>2</sub> equipment</span>
                                                    @{
                                                        var _device_o2 = sys_params_list.get_group_list("Index_device", "device_o2");
                                                        _device_o2.Clear();
                                                        _device_o2.Add(new SysParams() { P_VALUE = "RA", P_NAME = "RA" });
                                                        _device_o2.Add(new SysParams() { P_VALUE = "N/C", P_NAME = "N/C" });
                                                        _device_o2.Add(new SysParams() { P_VALUE = "O2 mask", P_NAME = "O2 mask" });
                                                        _device_o2.Add(new SysParams() { P_VALUE = "S/M", P_NAME = "S/M" });
                                                        _device_o2.Add(new SysParams() { P_VALUE = "V/M", P_NAME = "V/M" });
                                                        _device_o2.Add(new SysParams() { P_VALUE = "NRM", P_NAME = "NRM" });
                                                        _device_o2.Add(new SysParams() { P_VALUE = "Collar", P_NAME = "Collar" }); 
                                                        _device_o2.Add(new SysParams() { P_VALUE = "Nasal Prolong", P_NAME = "Nasal Prolong" });
                                                        _device_o2.Add(new SysParams() { P_VALUE = "Mask", P_NAME = "Mask" });
                                                        _device_o2.Add(new SysParams() { P_VALUE = "Full Face mask", P_NAME = "Full Face mask" });
                                                        _device_o2.Add(new SysParams() { P_VALUE = "Nasal mask", P_NAME = "Nasal mask" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("device_o2", new SelectList(_device_o2, "P_VALUE", "P_NAME"), "", new { @class = "form-control get_last mustOxygen hasMode hasOxygen", @tabindex = tableIndex++, @maxlength = "30", @data_rcs_cate = "device_o2", @type = "select", @id = "device_o2", @disabled = "disabled" })
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Tidal Volume Set / Total / insp. TV </span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="vt_set" id="vt_set" name="vt_set" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="799" data-min="301" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="exp_tv" id="exp_tv" name="exp_tv" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="vt" data-min="301" data-max="799" id="vt" name="vt" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Ventilation Rate Set / Total @*/ SIMV Rate*@</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="vr_set" id="vr_set" name="vr_set" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="34" data-min="9" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="vr" id="vr" name="vr" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="34" data-min="9" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Flow / Flow Pattern</span>
                                                    @{
                                                        var _flowp = sys_params_list.get_group_list("RTRecord_Detail", "flow");
                                                        _flowp.Add(new SysParams() { P_VALUE = "AF", P_NAME = "AF" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("flow", new SelectList(_flowp, "P_VALUE", "P_NAME"), "", new { @class = "form-control get_last editable_select", @tabindex = tableIndex++, @maxlength = "5", @data_min = "1", @data_max = "79", @data_rcs_cate = "flow", @type = "select", @id = "flow", @disabled = "disabled" })
                                                    <span class="input-group-addon">L</span>
                                                    <span class="input-group-addon">/</span>
                                                    @Html.DropDownList("flow_pattern", new SelectList(sys_params_list.get_group_list("RTRecord_Detail", "flow_pattern"), "P_VALUE", "P_NAME"),
                                                new { @class = "form-control editable_select get_last", @maxlength = "1", @data_min = "1", @data_max = "79", @tabindex = tableIndex++, @data_rcs_cate = "flow_pattern", @id = "flow_pattern", @type = "select" })
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">MV set / Total @*MV%*@</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="mv_set" id="mv_set" name="mv_set" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="14.9" data-min="3.1" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="mv" id="mv" name="mv" placeholder="" tabindex="@(tableIndex++)" maxlength="10" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Ti @*/ Ti%*@ / I/E Ratio</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="insp_time" id="insp_time" name="insp_time" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="1" data-min="0" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="ie_ratio" id="ie_ratio" name="ie_ratio" placeholder="" tabindex="@(tableIndex++)" maxlength="7" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Time High / Time Low</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="thigh" id="thigh" name="thigh" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="2.9" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="tlow" id="tlow" name="tlow" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-min="1.1" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">IPAP / EPAP</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="ipap" id="ipap" name="ipap" placeholder="" tabindex="@(tableIndex++)" maxlength="10" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="epap" id="epap" name="epap" placeholder="" tabindex="@(tableIndex++)" maxlength="10" />
                                                </div>
                                            </div>  
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Pressure (High / Low)</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="phigh" id="phigh" name="phigh" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="34" data-min="11" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="plow" id="plow" name="plow" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="9" />
                                                </div>
                                            </div>                                          
                                        </div>
                                        <div class="col-md-6 panel-body">                                            
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon"> P.S / P.C </span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="pressure_ps" id="pressure_ps" name="pressure_ps" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="30" data-min="0" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="pressure_pc" id="pressure_pc" name="pressure_pc" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="30" data-min="0" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon"> △ P / HFOV Hz </span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="delta_p" id="delta_p" name="delta_p" placeholder="" tabindex="@(tableIndex++)" maxlength="5"/>
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="hfov_hz" id="hfov_hz" name="hfov_hz" placeholder="" tabindex="@(tableIndex++)" maxlength="5"/>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Peak Pr. / HFOV mean(mmHg) </span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="pressure_peak" id="pressure_peak" name="pressure_peak" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="34" data-min="11" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="hfov_mean" id="hfov_mean" name="hfov_mean" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="34" data-min="11" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Mean / PEEP</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="pressure_mean" id="pressure_mean" name="pressure_mean" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="34" data-min="11" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="pressure_peep" id="pressure_peep" name="pressure_peep" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="9" data-min="0" />
                                                </div>
                                            </div> 
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">RM / Optimal PEEP</span>
                                                    @{
                                                        var _RM = sys_params_list.get_group_list("RTRecord_Detail", "RM");
                                                        _RM.Add(new SysParams() { P_VALUE = "Q6H", P_NAME = "Q6H" });
                                                        _RM.Add(new SysParams() { P_VALUE = "Q8H", P_NAME = "Q8H" });
                                                        _RM.Add(new SysParams() { P_VALUE = "Stat", P_NAME = "Stat" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("RM", new SelectList(_RM, "P_VALUE", "P_NAME"), "", new { @class = "form-control get_last editable_select", @tabindex = tableIndex++, @maxlength = "5", @data_rcs_cate = "RM", @type = "select", @id = "RM", @disabled = "disabled" })
                                                    <span class="input-group-addon">/</span>
                                                    @{
                                                        var _optimal_peep = sys_params_list.get_group_list("RTRecord_Detail", "optimal_peep");
                                                        _optimal_peep.Add(new SysParams() { P_VALUE = "12", P_NAME = "12" });
                                                        _optimal_peep.Add(new SysParams() { P_VALUE = "13", P_NAME = "13" });
                                                        _optimal_peep.Add(new SysParams() { P_VALUE = "14", P_NAME = "14" });
                                                        _optimal_peep.Add(new SysParams() { P_VALUE = "15", P_NAME = "15" });
                                                        _optimal_peep.Add(new SysParams() { P_VALUE = "16", P_NAME = "16" });
                                                        _optimal_peep.Add(new SysParams() { P_VALUE = "17", P_NAME = "17" });
                                                        _optimal_peep.Add(new SysParams() { P_VALUE = "18", P_NAME = "18" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("optimal_peep", new SelectList(_optimal_peep, "P_VALUE", "P_NAME"), "", new { @class = "form-control get_last editable_select", @tabindex = tableIndex++, @maxlength = "10", @data_rcs_cate = "optimal_peep", @type = "select", @id = "optimal_peep", @disabled = "disabled" })
                                                </div>
                                            </div>                                       
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">FiO<sub>2</sub>(%) /FiO<sub>2</sub> Analyzer measure @*(%)*@</span>
                                                    @{                                                    
                                                        var _fio2_set = sys_params_list.get_group_list("RTRecord_Detail", "fio2_set");
                                                        _fio2_set.Clear();
                                                        _fio2_set.Add(new SysParams() { P_VALUE = "35%", P_NAME = "35%" });
                                                        _fio2_set.Add(new SysParams() { P_VALUE = "40%", P_NAME = "40%" });
                                                        _fio2_set.Add(new SysParams() { P_VALUE = "50%", P_NAME = "50%" });
                                                        _fio2_set.Add(new SysParams() { P_VALUE = "70%", P_NAME = "70%" });
                                                        _fio2_set.Add(new SysParams() { P_VALUE = "100%", P_NAME = "100%" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("fio2_set", new SelectList(_fio2_set, "P_VALUE", "P_NAME"), "", new { @type = "select", @class = "form-control get_last editable_select", @maxlength = "12", @data_min = "21", @data_max = "59", @tabindex = tableIndex++, @data_rcs_cate = "fio2_set", @id = "fio2_set" })
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="fio2_measured" id="fio2_measured" name="fio2_measured" placeholder="" tabindex="@(tableIndex++)" maxlength="4" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">O<sub>2</sub> flow (LPM)</span>
                                                    @{
                                                        var _o2flow = sys_params_list.get_group_list("RTRecord_Detail", "o2flow");
                                                        _o2flow.Add(new SysParams() { P_VALUE = "1", P_NAME = "1" });
                                                        _o2flow.Add(new SysParams() { P_VALUE = "2", P_NAME = "2" });
                                                        _o2flow.Add(new SysParams() { P_VALUE = "3", P_NAME = "3" });
                                                        _o2flow.Add(new SysParams() { P_VALUE = "6", P_NAME = "6" });
                                                        _o2flow.Add(new SysParams() { P_VALUE = "8", P_NAME = "8" });
                                                        _o2flow.Add(new SysParams() { P_VALUE = "10", P_NAME = "10" });
                                                        _o2flow.Add(new SysParams() { P_VALUE = "12", P_NAME = "12" });
                                                        _o2flow.Add(new SysParams() { P_VALUE = "15", P_NAME = "15" });
                                                        _o2flow.Add(new SysParams() { P_VALUE = "Full", P_NAME = "Full" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("o2flow", new SelectList(_o2flow, "P_VALUE", "P_NAME"), "", new { @class = "form-control get_last editable_select", @tabindex = tableIndex++, @maxlength = "10", @data_rcs_cate = "o2flow", @type = "select", @id = "o2flow", @disabled = "disabled" })
                                                    <span class="input-group-addon">L</span>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Sensitivity (Pr cmH<sub>2</sub>O / F lpm)</span>
                                                    @{                                                    
                                                        var _pressure_sensitivity = sys_params_list.get_group_list("RTRecord_Detail", "pressure_sensitivity");
                                                        _pressure_sensitivity.Clear();
                                                        _pressure_sensitivity.Add(new SysParams() { P_VALUE = "P-1", P_NAME = "P-1" });
                                                        _pressure_sensitivity.Add(new SysParams() { P_VALUE = "P-2", P_NAME = "P-2" });
                                                        _pressure_sensitivity.Add(new SysParams() { P_VALUE = "P-3", P_NAME = "P-3" });
                                                        _pressure_sensitivity.Add(new SysParams() { P_VALUE = "P-4", P_NAME = "P-4" });
                                                        _pressure_sensitivity.Add(new SysParams() { P_VALUE = "P-5", P_NAME = "P-5" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("pressure_sensitivity", new SelectList(_pressure_sensitivity, "P_VALUE", "P_NAME"), "", new { @type = "select", @class = "form-control get_last editable_select", @maxlength = "15", @tabindex = tableIndex++, @data_rcs_cate = "pressure_sensitivity", @id = "pressure_sensitivity" })
                                                    <span class="input-group-addon">/</span>
                                                    @{
                                                        var _sensitivity_flow = sys_params_list.get_group_list("RTRecord_Detail", "sensitivity_flow");
                                                        _sensitivity_flow.Clear();
                                                        _sensitivity_flow.Add(new SysParams() { P_VALUE = "F1", P_NAME = "F1" });
                                                        _sensitivity_flow.Add(new SysParams() { P_VALUE = "F2", P_NAME = "F2" });
                                                        _sensitivity_flow.Add(new SysParams() { P_VALUE = "F3", P_NAME = "F3" });
                                                        _sensitivity_flow.Add(new SysParams() { P_VALUE = "F4", P_NAME = "F4" });
                                                        _sensitivity_flow.Add(new SysParams() { P_VALUE = "F5", P_NAME = "F5" });
                                                        _sensitivity_flow.Add(new SysParams() { P_VALUE = "F6", P_NAME = "F6" });
                                                        _sensitivity_flow.Add(new SysParams() { P_VALUE = "F7", P_NAME = "F7" });
                                                        _sensitivity_flow.Add(new SysParams() { P_VALUE = "F8", P_NAME = "F8" });
                                                        _sensitivity_flow.Add(new SysParams() { P_VALUE = "F9", P_NAME = "F9" });
                                                        _sensitivity_flow.Add(new SysParams() { P_VALUE = "F10", P_NAME = "F10" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("sensitivity_flow", new SelectList(_sensitivity_flow, "P_VALUE", "P_NAME"), "", new { @type = "select", @class = "form-control get_last editable_select", @maxlength = "15", @tabindex = tableIndex++, @data_rcs_cate = "sensitivity_flow", @id = "sensitivity_flow" })
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Raw / C</span>
                                                    <input type="text" class="form-control" data-rcs-cate="resistance" id="resistance" name="resistance" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="Compliance" id="Compliance" name="Compliance" maxlength="10" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Min. MV alarm / Pr. Alarm </span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="low_mv_alarm" id="low_mv_alarm" name="low_mv_alarm" placeholder="" tabindex="@(tableIndex++)" maxlength="5" data-max="59" data-min="25" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="paw_alarm" id="paw_alarm" name="paw_alarm" placeholder="" tabindex="@(tableIndex++)" maxlength="5" />
                                                </div>
                                            </div>
                                        </div>                                  
                                    </div>
                                    <div class="clearfix">
                                    </div>
                                </div>
                                <div class="col-lg-2 col-xs-2  list-group-item-text">
                                    <div class="list_span">
                                        <i class="fa fa-flask" aria-hidden="true">&ensp;檢驗資料&ensp;</i>
                                    </div>
                                </div>
                                <div class="col-lg-5 col-xs-5 list-group-item list-group-item-warning">
                                    <div class="list_span">
                                        <i class="fa fa-chevron-circle-down panel_head dataRow panel-title pull-left" aria-label="abg" aria-hidden="true">&ensp;動脈血氣體分析&emsp;</i>
                                        <span class="pull-right">
                                            <span class="form-block" data-rcs-cate="self_abg">
                                                <input type="checkbox" class="form-field" name="self_abg" id="self_abg" /><label for="self_abg" style="display:inline;">自己測</label>
                                            </span>
                                            <button style="font-size:12px;" class="btn btn-xs btn-warning exec-func" data-func="get_abg" data-loading-text="取得中..." chktype><span class="glyphicon glyphicon-check"></span>&nbsp;3日內ABG</button>
                                            @*<input type="checkbox" class="bootstrapSwitch" data-on-color="warning" data-size="mini">*@
                                        </span>
                                    </div>
                                </div>
                                <div class="col-lg-5 col-xs-5 list-group-item list-group-item-warning">
                                    <div class="list_span">
                                        <i class="fa fa-chevron-circle-down panel_head dataRow panel-title pull-left" aria-label="biochem" aria-hidden="true">&ensp;血液生化&emsp;</i>
                                        <span class="pull-right">
                                            <button style="font-size:12px;" class="btn btn-xs btn-warning exec-func" data-func="showLabData" data-loading-text="取得中..." chktype><span class="glyphicon glyphicon-zoom-in"></span>&nbsp;取得檢驗資料</button>
                                            @*<input type="checkbox" class="bootstrapSwitch" data-on-color="success" data-size="mini">*@
                                        </span>
                                    </div>
                                </div>
                                <div class="col-lg-12 col-md-12 panel panel-warning panel-side" id="abgDataPanel">
                                    <div class="panel-leftheading bg-warning">
                                        A<br />B<br />G
                                    </div>
                                    <div class="panel-rightbody">
                                        <div class="col-md-6 panel-body">
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon form-block" @*data-rcs-cate="vbg"*@>
                                                        Time
                                                    </span>
                                                    <input type="text" class="form-control dt-picker" dt-sidebyside="true" data-rcs-cate="abg_time" id="abg_time" name="abg_time" placeholder="" tabindex="@(tableIndex++)" readonly />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">pH</span>
                                                    <input type="text" class="form-control" data-rcs-cate="abg_ph" id="abg_ph" name="abg_ph" placeholder="" tabindex="@(tableIndex++)" maxlength="10" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">PaCO<sub>2</sub></span>
                                                    <input type="text" class="form-control" data-rcs-cate="abg_paco2" id="abg_paco2" name="abg_paco2" placeholder="" tabindex="@(tableIndex++)" maxlength="10" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">PaO<sub>2</sub></span>
                                                    <input type="text" class="form-control" data-rcs-cate="abg_pao2" id="abg_pao2" name="abg_pao2" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 panel-body">                                            
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">HCO<sub>3</sub> / B.E.</span>
                                                    <input type="text" class="form-control" data-rcs-cate="abg_hco3" id="abg_hco3" name="abg_hco3" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="abg_be" id="abg_be" name="abg_be" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">SaO<sub>2</sub> / SpO<sub>2</sub> (%)</span>
                                                    <input type="text" class="form-control" data-rcs-cate="abg_sao2" id="abg_sao2" name="abg_sao2" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control get_last" data-rcs-cate="spo2" id="spo2" name="spo2" placeholder="" tabindex="@(tableIndex++)" maxlength="15" data-min="90" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">
                                                        P/F ratio&ensp;<i class="fas fa-calculator" title="PaO2/FiO2" onclick="RTRecord_keyup('pao2_fio2');" style="cursor: pointer;"></i> /
                                                        O.I Index&ensp;<i class="fas fa-calculator" title="（Fio2xMAP）/PaO2" onclick="RTRecord_keyup('oi');" style="cursor: pointer;"></i>
                                                    </span>
                                                    <input type="text" class="form-control" data-rcs-cate="pao2_fio2" id="pao2_fio2" name="pao2_fio2" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="oi" id="oi" name="oi" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                        </div> 
                                    </div>
                                    <div class="clearfix">
                                    </div>
                                </div>
                                <div class="col-lg-12 col-md-12 panel panel-warning panel-side" id="biochemDataPanel">
                                    <div class="panel-leftheading bg-warning">
                                        血液生化
                                    </div>
                                    <div class="panel-rightbody">
                                        <div class="col-md-6 panel-body">
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <div class="input-group input-group-sm">
                                                        <span class="input-group-addon">Hb / Platelet</span>
                                                        <input type="text" class="form-control" data-rcs-cate="biochem_hb" id="biochem_hb" name="biochem_hb" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                        <span class="input-group-addon">/</span>
                                                        <input type="text" class="form-control" data-rcs-cate="biochem_p" id="biochem_p" name="biochem_p" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">WBC / CRP</span>
                                                    <input type="text" class="form-control" data-rcs-cate="biochem_wbc" id="biochem_wbc" name="biochem_wbc" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="biochem_crp" id="biochem_crp" name="biochem_crp" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Na / K(m.Eq/L)</span>
                                                    <input type="text" class="form-control" data-rcs-cate="biochem_na" id="biochem_na" name="biochem_na" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="biochem_k" id="biochem_k" name="biochem_k" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 panel-body">
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">BUN / Cr.(mg%)</span>
                                                    <input type="text" class="form-control" data-rcs-cate="biochem_bun" id="biochem_bun" name="biochem_bun" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="biochem_cr" id="biochem_cr" name="biochem_cr" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Ca / Cl</span>
                                                    <input type="text" class="form-control" data-rcs-cate="biochem_ca" id="biochem_ca" name="biochem_ca" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="biochem_cl" id="biochem_cl" name="biochem_cl" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Albumin</span>
                                                    <input type="text" class="form-control" data-rcs-cate="biochem_albumin_sugar" id="biochem_albumin_sugar" name="biochem_albumin_sugar" placeholder="" tabindex="@(tableIndex++)" maxlength="10" />
                                                </div>
                                            </div>
                                        </div> 
                                    </div>
                                    <div class="clearfix">
                                    </div>
                                </div>                                
                                <div class="col-lg-12 col-md-12 panel panel-success panel-side">
                                    <div class="panel-leftheading bg-success">
                                        脫離指標
                                    </div>
                                    <div class="panel-rightbody">
                                        <div class="col-md-6 panel-body">
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">
                                                        評估時間
                                                    </span>
                                                    <input type="text" class="form-control dt-picker" dt-sidebyside="true" dt-format="t" data-rcs-cate="evaluation_time" id="evaluation_time" name="evaluation_time" placeholder="" tabindex="@(tableIndex++)" readonly />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">@*MV*@ VT(ml) / RR (bpm)</span>
                                                    @*<input type="text" class="form-control" data-rcs-cate="mv_value" id="mv_value" name="mv_value" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />*@
                                                    <input type="text" class="form-control" data-rcs-cate="vt_value" id="vt_value" name="vt_value" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="rsi_srr" id="rsi_srr" name="rsi_srr" tabindex="@(tableIndex++)" maxlength="20" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">
                                                        RSBI
                                                        @* &ensp;<i class="fas fa-calculator" title="RSI=Srr/(VT/1000)" onclick="RTRecord_keyup('rsbi');" style="cursor: pointer;"></i>*@
                                                    </span>
                                                    @*<span class="input-group-addon">/</span>*@
                                                    <input type="text" class="form-control" data-rcs-cate="rsbi" id="rsbi" name="rsbi" tabindex="@(tableIndex++)" maxlength="20" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 panel-body">
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Pi/E max(cmH<sub>2</sub>O)</span>
                                                    <input type="text" class="form-control" data-rcs-cate="pi_max" id="pi_max" name="pi_max" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="pe_max" id="pe_max" name="pe_max" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">
                                                        Cuff-leak test (ml) @*/ (%)*@
                                                    </span>
                                                    <input type="text" class="form-control" data-rcs-cate="cuff_leak_ml" id="cuff_leak_ml" name="cuff_leak_ml" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clearfix">
                                    </div>
                                </div>                                
                                <div class="col-lg-12 col-md-12 panel panel-success panel-side">
                                    <div class="panel-leftheading bg-success" style="font-size:12px;">
                                        NO
                                    </div>
                                    <div class="panel-rightbody">
                                        <div class="col-md-6">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-addon">NO set/ mea. (ppm)</span>
                                                <input type="text" class="form-control" data-rcs-cate="no_set" id="no_set" name="no_set" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                <span class="input-group-addon">/</span>
                                                <input type="text" class="form-control get_last" data-rcs-cate="no" id="no" name="no" placeholder="" tabindex="@(tableIndex++)" maxlength="2" />
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-addon">NO<sub>2</sub> mea. (ppm) / C.O. @*/ Pump speed*@</span>
                                                <input type="text" class="form-control" data-rcs-cate="other_no2" id="other_no2" name="other_no2" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                <span class="input-group-addon">/</span>
                                                <input type="text" class="form-control" data-rcs-cate="ecmo_co" id="ecmo_co" name="ecmo_co" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                @*<input type="text" class="form-control" data-rcs-cate="other_pump_speed" id="other_pump_speed" name="other_pump_speed" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />*@
                                            </div>
                                        </div>
                                    </div>                                    
                                    <div class="clearfix">
                                    </div>
                                </div>
                                <div class="col-lg-12 col-md-12 panel panel-success panel-side">
                                    <div class="panel-leftheading bg-success" style="font-size:12px;text-align: center;" >
                                        E<br />C<br />M<br />O
                                    </div>
                                    <div class="panel-rightbody">
                                        <div class="col-md-6 panel-body">
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">ECMO type</span>
                                                    @{
                                                        var _ecmo = sys_params_list.get_group_list("RTRecord_Detail", "ecmo");
                                                        _ecmo.Add(new SysParams() { P_VALUE = "V-A ECMO", P_NAME = "V-A ECMO" });
                                                        _ecmo.Add(new SysParams() { P_VALUE = "V-V ECMO", P_NAME = "V-V ECMO" });
                                                        _ecmo.Add(new SysParams() { P_VALUE = "V-V+V-A", P_NAME = "V-V+V-A" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("ecmo", new SelectList(_ecmo, "P_VALUE", "P_NAME"), "", new { @type = "select", @class = "form-control", @maxlength = "5", @tabindex = tableIndex++, @data_rcs_cate = "ecmo", @id = "ecmo" })
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Pump speed (RPM) / (L/min)</span>
                                                    <input type="text" class="form-control" data-rcs-cate="ecmo_pump_speed" id="ecmo_pump_speed" name="ecmo_pump_speed" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="ecmo_pump_speed_lmin" id="ecmo_pump_speed_lmin" name="ecmo_pump_speed_lmin" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">
                                                        Blood Flow (L/min)
                                                    </span>
                                                    <input type="text" class="form-control" data-rcs-cate="blood_flow" id="blood_flow" name="blood_flow" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 panel-body">
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">
                                                        Gas Flow (L/min)
                                                    </span>
                                                    <input type="text" class="form-control" data-rcs-cate="gas_flow" id="gas_flow" name="gas_flow" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">FiO<sub>2</sub> / SvO<sub>2</sub> (%) @*Air flow*@</span>
                                                    <input type="text" class="form-control" data-rcs-cate="ecmo_fio2" id="ecmo_fio2" name="ecmo_fio2" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="ecmo_svo2" id="ecmo_svo2" name="ecmo_svo2" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    @*<input type="text" class="form-control" data-rcs-cate="ecmo_air_flow" id="ecmo_air_flow" name="ecmo_air_flow" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />*@
                                                </div>
                                            </div> 
                                        </div>                                
                                    </div>
                                    <div class="clearfix">
                                    </div>
                                </div>
                                <div class="col-lg-12 col-md-12 panel panel-success panel-side">
                                    <div class="panel-leftheading bg-success">
                                        氣道監測
                                    </div>
                                    <div class="panel-rightbody">
                                        <div class="col-md-6 panel-body">
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm list-group-item-warning">
                                                    <span class="input-group-addon">
                                                        E.T. Tube
                                                        &ensp;<i class="fas fa-broom" title="清空插管資料" onclick="clear_tube();" style="cursor: pointer;"></i>
                                                    </span>
                                                    @{
                                                        var _artificial_airway_type = sys_params_list.get_group_list("RTRecord_Detail", "artificial_airway_type");
                                                        _artificial_airway_type.Clear();
                                                        _artificial_airway_type.Add(new SysParams() { P_VALUE = "Oral endo", P_NAME = "Oral endo" });
                                                        _artificial_airway_type.Add(new SysParams() { P_VALUE = "Nasal endo", P_NAME = "Nasal endo" });
                                                        _artificial_airway_type.Add(new SysParams() { P_VALUE = "Tr", P_NAME = "Tr" }); 

                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("artificial_airway_type", new SelectList(_artificial_airway_type, "P_VALUE", "P_NAME"), "", new { @type = "select", @class = "form-control get_last mustIntubate hasMode hasIntubate editable_select", @maxlength = "20", @tabindex = tableIndex++, @data_rcs_cate = "artificial_airway_type", @id = "artificial_airway_type", @style = "background-color:#FCF8E3;" })
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm list-group-item-warning">
                                                    <span class="input-group-addon">E.T. size / mark</span>
                                                    @{
                                                        var _et_size = sys_params_list.get_group_list("RTRecord_Detail", "et_size");
                                                        _et_size.Clear();
                                                        _et_size.Add(new SysParams() { P_VALUE = "6.0", P_NAME = "6.0" });
                                                        _et_size.Add(new SysParams() { P_VALUE = "6.5", P_NAME = "6.5" });
                                                        _et_size.Add(new SysParams() { P_VALUE = "7.0", P_NAME = "7.0" });
                                                        _et_size.Add(new SysParams() { P_VALUE = "7.5", P_NAME = "7.5" });
                                                        _et_size.Add(new SysParams() { P_VALUE = "8.0", P_NAME = "8.0" });
                                                        _et_size.Add(new SysParams() { P_VALUE = "8.5", P_NAME = "8.5" });
                                                        _et_size.Add(new SysParams() { P_VALUE = "Mask", P_NAME = "Mask" });
                                                        _et_size.Add(new SysParams() { P_VALUE = "Full face mask", P_NAME = "Full face mask" });
                                                        _et_size.Add(new SysParams() { P_VALUE = "Nasal prong", P_NAME = "Nasal prong" });
                                                        //TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("et_size", new SelectList(_et_size, "P_VALUE", "P_NAME"), "", new { @style = "background-color:#FCF8E3;", @type = "select", @class = "form-control get_last mustIntubate editable_select", @maxlength = "5", @tabindex = tableIndex++, @data_rcs_cate = "et_size", @id = "et_size" })
                                                    <span class="input-group-addon">/</span>
                                                    @{
                                                        var _et_mark = sys_params_list.get_group_list("RTRecord_Detail", "et_mark");
                                                        _et_mark.Clear();
                                                        _et_mark.Add(new SysParams() { P_VALUE = "20", P_NAME = "20" });
                                                        _et_mark.Add(new SysParams() { P_VALUE = "21", P_NAME = "21" });
                                                        _et_mark.Add(new SysParams() { P_VALUE = "22", P_NAME = "22" });
                                                        _et_mark.Add(new SysParams() { P_VALUE = "23", P_NAME = "23" });
                                                        _et_mark.Add(new SysParams() { P_VALUE = "24", P_NAME = "24" });
                                                        _et_mark.Add(new SysParams() { P_VALUE = "25", P_NAME = "25" });
                                                        _et_mark.Add(new SysParams() { P_VALUE = "26", P_NAME = "26" });
                                                        _et_mark.Add(new SysParams() { P_VALUE = "27", P_NAME = "27" });
                                                        _et_mark.Add(new SysParams() { P_VALUE = "28", P_NAME = "28" });
                                                        _et_mark.Add(new SysParams() { P_VALUE = "29", P_NAME = "29" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("et_mark", new SelectList(_et_mark, "P_VALUE", "P_NAME"), "", new { @style = "background-color:#FCF8E3;", @type = "select", @class = "form-control get_last mustIntubate editable_select", @maxlength = "5", @data_max = "24", @data_min = "16", @tabindex = tableIndex++, @data_rcs_cate = "et_mark", @id = "et_mark" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 panel-body">
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Cuff pressure (cmH<sub>2</sub>O) ml</span>
                                                    @{
                                                        var _cuff = sys_params_list.get_group_list("RTRecord_Detail", "cuff");
                                                        _cuff.Clear();
                                                        _cuff.Add(new SysParams() { P_VALUE = "decuff", P_NAME = "decuff" });
                                                        _cuff.Add(new SysParams() { P_VALUE = "24", P_NAME = "24" });
                                                        _cuff.Add(new SysParams() { P_VALUE = "26 ", P_NAME = "26 " });
                                                        _cuff.Add(new SysParams() { P_VALUE = "28", P_NAME = "28" });
                                                        _cuff.Add(new SysParams() { P_VALUE = "30", P_NAME = "30" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("cuff", new SelectList(_cuff, "P_VALUE", "P_NAME"), "", new { @type = "select", @class = "form-control get_last editable_select", @maxlength = "10", @data_max = "30", @data_min = "24", @tabindex = tableIndex++, @data_rcs_cate = "cuff", @id = "cuff" })
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Breath sound</span>
                                                    @{
                                                        var _breath_sound = sys_params_list.get_group_list("RTRecord_Detail", "breath_sound");
                                                        _breath_sound.Clear();
                                                        _breath_sound.Add(new SysParams() { P_VALUE = "Coarse", P_NAME = "Coarse" });
                                                        _breath_sound.Add(new SysParams() { P_VALUE = "Crackle", P_NAME = "Crackle" });
                                                        _breath_sound.Add(new SysParams() { P_VALUE = "Rhonchi ", P_NAME = "Rhonchi " });
                                                        _breath_sound.Add(new SysParams() { P_VALUE = "Wheezing", P_NAME = "Wheezing" });
                                                        _breath_sound.Add(new SysParams() { P_VALUE = "Stridor", P_NAME = "Stridor" });
                                                        _breath_sound.Add(new SysParams() { P_VALUE = "Decreased", P_NAME = "Decreased" });
                                                        _breath_sound.Add(new SysParams() { P_VALUE = "End expiratory wheezing", P_NAME = "End expiratory wheezing" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("breath_sound", new SelectList(_breath_sound, "P_VALUE", "P_NAME"), "", new { @type = "select", @class = "form-control get_last editable_select", @maxlength = "20", @tabindex = tableIndex++, @data_rcs_cate = "breath_sound", @id = "breath_sound" })
                                                </div>
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">Breath sound</span>
                                                    @{
                                                        var _breath_sound_location = new List<SysParams>(); 
                                                        _breath_sound_location.Add(new SysParams() { P_VALUE = "Bilateral", P_NAME = "Bilateral" });
                                                        _breath_sound_location.Add(new SysParams() { P_VALUE = "RLL", P_NAME = "RLL" });
                                                        _breath_sound_location.Add(new SysParams() { P_VALUE = "RUL ", P_NAME = "RUL " });
                                                        _breath_sound_location.Add(new SysParams() { P_VALUE = "RML", P_NAME = "RML" });
                                                        _breath_sound_location.Add(new SysParams() { P_VALUE = "LUL", P_NAME = "LUL" });
                                                        _breath_sound_location.Add(new SysParams() { P_VALUE = "LLL", P_NAME = "LLL" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("breath_sound_location", new SelectList(_breath_sound_location, "P_VALUE", "P_NAME"), "", new { @type = "select", @class = "form-control get_last editable_select", @maxlength = "20", @tabindex = tableIndex++, @data_rcs_cate = "breath_sound_location", @id = "breath_sound_location" })
                                                </div>
                                            </div> 
                                        </div>
                                        <div class="col-md-12"></div>
                                        <div class="col-md-12"></div>
                                        <div class="col-md-12"></div>
                                    </div>
                                    <div class="clearfix">
                                    </div>
                                </div>                                 
                                <div class="col-lg-12 col-md-12 panel panel-success panel-side">
                                    <div class="panel-leftheading bg-success">
                                        血行力學
                                    </div>
                                    <div class="panel-rightbody">
                                        <div class="col-md-6 panel-body">
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">PR / Temp</span>
                                                    <input type="text" class="form-control" data-rcs-cate="pulse" id="pulse" name="pulse" maxlength="10" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="vital_signs_temp" id="vital_signs_temp" name="vital_signs_temp" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">BP(S/D)(mmHg)</span>
                                                    <input type="text" class="form-control" data-rcs-cate="bps" id="bps" name="bps" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                    <span class="input-group-addon">/</span>
                                                    <input type="text" class="form-control" data-rcs-cate="bpd" id="bpd" name="bpd" maxlength="5" placeholder="" tabindex="@(tableIndex++)" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm gcs">
                                                    <span class="input-group-addon">Con's level(E.V.M.)</span>
                                                    @Html.DropDownList("gcse", new SelectList(sys_params_list.get_group_list("RTRecord_Detail", "gcse"), "P_VALUE", "P_NAME"), "", new { @class = "form-control get_last", @maxlength = "1", @data_rcs_cate = "gcse", @type = "select", @placeholder = "1~4", @tabindex = tableIndex++ })
                                                    <span class="input-group-addon">/</span>
                                                    @Html.DropDownList("gcsv", new SelectList(sys_params_list.get_group_list("RTRecord_Detail", "gcsv"), "P_VALUE", "P_NAME"), "", new { @class = "form-control get_last", @maxlength = "1", @data_rcs_cate = "gcsv", @type = "select", @placeholder = "1~5", @tabindex = tableIndex++ })
                                                    <span class="input-group-addon">/</span>
                                                    @Html.DropDownList("gcsm", new SelectList(sys_params_list.get_group_list("RTRecord_Detail", "gcsm"), "P_VALUE", "P_NAME"), "", new { @class = "form-control get_last", @maxlength = "1", @data_rcs_cate = "gcsm", @type = "select", @placeholder = "1~6", @tabindex = tableIndex++ })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 panel-body">
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-addon">意識</span>
                                                    <select type="select" class="form-control editable_select get_last" data-rcs-cate="conscious" id="conscious" name="conscious" tabindex="@(tableIndex++)">
                                                        <option value=""></option>
                                                        <option value="ANS">ANS</option>
                                                        <option value="Alert">Alert</option>
                                                        <option value="drowsy">drowsy</option>
                                                        <option value="stupor">stupor</option>
                                                        <option value="confuse">confuse</option>
                                                        <option value="semicoma">semicoma</option>
                                                        <option value="coma">coma</option>
                                                        <option value="good">good</option>
                                                        <option value="poor">poor</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm gcs">
                                                    <span class="input-group-addon">集水杯</span>
                                                    @{
                                                        var _water_collecting_cup = sys_params_list.get_group_list("RTRecord_Detail", "water_collecting_cup");
                                                        _water_collecting_cup.Add(new SysParams() { P_VALUE = "HMEF", P_NAME = "HMEF" });
                                                        _water_collecting_cup.Add(new SysParams() { P_VALUE = "V", P_NAME = "V" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("water_collecting_cup", new SelectList(_water_collecting_cup, "P_VALUE", "P_NAME"), "", new { @type = "select", @class = "form-control", @maxlength = "5", @tabindex = tableIndex++, @data_rcs_cate = "water_collecting_cup", @id = "water_collecting_cup" })
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="input-group input-group-sm gcs">
                                                    <span class="input-group-addon">固定腳架</span>
                                                    @{
                                                        var _fixed_tripod = sys_params_list.get_group_list("RTRecord_Detail", "fixed_tripod");

                                                        _fixed_tripod.Add(new SysParams() { P_VALUE = "V", P_NAME = "V" });
                                                        // TODO:上線後需進資料庫修改
                                                    }
                                                    @Html.DropDownList("fixed_tripod", new SelectList(_fixed_tripod, "P_VALUE", "P_NAME"), "", new { @type = "select", @class = "form-control", @maxlength = "5", @tabindex = tableIndex++, @data_rcs_cate = "fixed_tripod", @id = "fixed_tripod" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clearfix">
                                    </div>
                                </div>                                  
                                <div class="col-lg-12 col-md-12 panel panel-info panel-side">
                                    <div class="panel-leftheading bg-info">
                                    </div>
                                    <div class="panel-rightbody">

                                        <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4">
                                            <div class="input-group-addon" style="height: 54px;">
                                                備註&ensp;
                                                <span class="display_count" id="memo_display_count"></span>
                                                <span class="pull-right">
                                                    @*<button class="btn btn-warning btn-sm" onclick="get_cpt_data();return false;" chktype>
                                                        <span class="glyphicon glyphicon-copy"></span>&nbsp;入院經過
                                                    </button>*@
                                                    <button class="btn btn-default btn-sm exec-func" data-func="phrase" data-target="#memo" chktype>
                                                        <span class="glyphicon glyphicon-copy"></span>&nbsp;片語
                                                    </button>
                                                </span>

                                            </div>
                                        </div>
                                        <div class="col-12 col-sm-12 col-md-8 col-lg-8 col-xl-8">
                                            <textarea onkeyup="onkeyup_Textarea_Count('memo_display_count','memo');" class="form-control" data-rcs-cate="memo" id="memo" name="memo" rows="2" tabindex="@(tableIndex++)" maxlength="1000">@Model.rt_record.memo</textarea>
                                            <input type="hidden" class="form-control" data-rcs-cate="Blood_biochemistry_memo" name="Blood_biochemistry_memo" id="Blood_biochemistry_memo" value="" />
                                        </div>
                                        <div class="col-12 col-sm-12 col-md-4 col-lg-4  col-xl-4">
                                            <div class="input-group-addon" style="height: 54px;">
                                                藥物/輸液備註&ensp;
                                                <span class="display_count" id="drug_memo_display_count"></span>
                                                <button class="btn btn-default btn-sm exec-func pull-right" data-func="phrase" data-target="#drug_memo" chktype>
                                                    <span class="glyphicon glyphicon-copy"></span>&nbsp;片語
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-12 col-sm-12 col-md-8 col-lg-8  col-xl-8">
                                            <textarea onkeyup="onkeyup_Textarea_Count('drug_memo_display_count','drug_memo');" class="form-control" data-rcs-cate="drug_memo" id="drug_memo" name="drug_memo" rows="2" tabindex="@(tableIndex++)" maxlength="200">@Model.rt_record.drug_memo</textarea>
                                        </div>
                                    </div>
                                    <div class="clearfix">
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </form><!-- end of form -->
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade setScrollbar phraseCarry" tabindex="-1" role="dialog" id="phrase_panel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <div class="btn-group pull-right" style="margin-top: 0.3em;">
                    <button class="btn btn-info exec-func" data-func="carry-in">帶入</button>
                    <button class="btn btn-warning" data-dismiss="modal"><span class="glyphicon glyphicon-folder-close"></span>&nbsp;關閉</button>
                </div>
                <h4 class="modal-title">片語選擇</h4>
            </div>
            <div class="modal-body">
                <table id="phrase_table" class="table table-hover table-condensed table-no-bordered">
                    <thead>
                        <tr>
                            <th data-checkbox="true"></th>
                            <th data-field="P_VALUE">片語內容</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div class="modal fade setScrollbar" tabindex="-1" role="dialog" id="abg_panel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <div class="btn-group pull-right" style="margin-top: 0.3em;">
                    <button class="btn btn-warning" data-dismiss="modal"><span class="glyphicon glyphicon-folder-close"></span>&nbsp;關閉</button>
                </div>
                <h4 class="modal-title">最近三日ABG</h4>
            </div>
            <div class="modal-body">
                <table id="abg_table" class="table table-hover table-condensed table-no-bordered">
                    <thead>
                        <tr>
                            <th data-field="Date">Time</th>
                            <th data-field="pH">PH</th>
                            <th data-field="PCO2">PaCO<sub>2</sub></th>
                            <th data-field="PO2">PaO<sub>2</sub></th>
                            <th data-field="SaO2">SaO<sub>2</sub></th>
                            <th data-field="HCO3">HCO<sub>3</sub></th>
                            <th data-field="BaseExcess">BE</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div class="modal fade" tabindex="-1" role="dialog" id="lastStop_date_panel">
    <div class=" modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <div class="btn-group pull-right" style="margin-top: 0.3em;">
                    <button class="btn btn-info exec-func" data-func="carry-in">確認</button>
                </div>
                <h4 class="modal-title">結束上一筆日期</h4>
            </div>
            <div class="modal-body">
                <div>呼吸結束日期</div>
                <div><input type="text" class="form-control input-sm dt-picker" id="breath_LastStop_date" name="breath_LastStop_date" dt-sidebyside="true" readonly /></div>
                <div>氧療結束日期</div>
                <div><input type="text" class="form-control input-sm dt-picker" id="oxygen_LastStop_date" name="oxygen_LastStop_date" dt-sidebyside="true" readonly /></div>
                <div>插管結束日期</div>
                <div><input type="text" class="form-control input-sm dt-picker" id="intubate_LastStop_date" name="intubate_LastStop_date" dt-sidebyside="true" readonly /></div>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal --> 
@*血液生化資料選擇畫面*@
<div class="modal fade setScrollbar phraseCarry" tabindex="-1" role="dialog" id="labdata_table_panel">
    <div class="modal-dialog">
        <div class="modal-content" style="width:655px;">
            <div class="modal-header">
                <div class="btn-group pull-right" style="margin-top: 0.3em;">
                    <button class="btn btn-warning" data-dismiss="modal"><span class="glyphicon glyphicon-folder-close"></span>&nbsp;關閉</button>
                </div>
                <h4 class="modal-title">血液生化</h4>
            </div>
            <div class="modal-body">
                <table id="labdata_table" class="table table-hover table-condensed table-no-bordered">
                    <thead>
                        <tr>
                            <th data-field="examDate">Time</th>
                            <th data-field="examContent.Hb.result">Hb</th>
                            <th data-field="examContent.Ht.result">Ht</th>
                            <th data-field="examContent.WBC.result">WBC</th>
                            <th data-field="examContent.Platelet.result">P</th>
                            <th data-field="examContent.Na.result">Na</th>
                            <th data-field="examContent.K.result">K</th>
                            <th data-field="examContent.BUN.result">BUN</th>
                            <th data-field="examContent.Cr.result">Cr.</th>
                            <th data-field="examContent.Albumin.result">Albumin Sugar</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
@*血液生化資料選擇畫面*@
<div class="modal fade setScrollbar phraseCarry" tabindex="-1" role="dialog" id="LabData_panel">
    <div class=" modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <div class="btn-group pull-right" style="margin-top: 0.3em;">
                    <button class="btn btn-info exec-func" data-func="getLabData">帶入</button>
                    <button class="btn btn-warning" data-dismiss="modal"><span class="glyphicon glyphicon-folder-close"></span>&nbsp;關閉</button>
                </div>
                <h4 class="modal-title">血液生化檢驗</h4>
            </div>
            <div class="modal-body" id="LabDatabody" style="overflow-y:auto; max-height:800px;"></div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
@*血液生化項目*@
<div class="modal fade" role="dialog" id="LabDataBlock">
    <fieldset class="fieldsetOrgStyle" id="LabDataFieldset">
        <legend class="legendOrgStyle"></legend>
        <div id="LabDataDiv"></div>
    </fieldset>
</div>
@*血液生化資料*@
<div class="modal fade" role="dialog" id="LabDataItem">
    <span><input type="checkbox" id=""><label for="" style="margin-left: 10px; "></label></span>
</div>
<!-- Modal -->
<div id="BreathListModal" class="modal fade setScrollbar" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">呼吸器記錄</h4>
            </div>
            <div class="modal-body">
                <table id="Breath_table" class="table table-hover table-condensed table-no-bordered">
                    <thead>
                        <tr>
                            <th data-field="RECORDDATE">記錄單日期</th>
                            <th data-field="device">機型</th>
                            <th data-field="mode">mode</th>
                            <th data-field="device_o2">device o2</th>
                            <th data-field="CREATE_NAME">記錄者</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div><!-- Modal -->
@{
    Model.rt_record.memo = "";
    Model.rt_record.drug_memo = "";
    /*--------------- Cxr繪圖 2018.08.29 [下] ---------------*/
    //需先清空 [CXR_result_json] 格式不符合，另外 [openCxrEditForm] 呼叫
    Model.rt_record.CXR_result_json = "";
    /*--------------- Cxr繪圖 2018.08.29 [上] ---------------*/
    RECORDData = Newtonsoft.Json.JsonConvert.SerializeObject(Model);
}
 @*統計註記資料*@
<div id="work_panel_div">
    <div class="modal fade setScrollbar" tabindex="-1" role="dialog" id="work_panel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="btn-group pull-right" style="margin-top: 0.3em;">
                        <button class="btn btn-success" v-on:click="save"><span class="glyphicon glyphicon-save"></span>&nbsp;儲存</button>
                        <button class="btn btn-warning" data-dismiss="modal"><span class="glyphicon glyphicon-folder-close"></span>&nbsp;關閉</button>
                    </div>
                    <h4 class="modal-title">統計註記</h4>
                </div>
                <div class="modal-body">
                    <div class="panel panel-default">
                        <div class="panel-heading">統計註記</div>
                        <div class="panel-body">
                            <label>
                                <input type="checkbox" v-model="checkList" value="轉入" />
                                &ensp;轉入
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="轉出" />
                                &ensp;轉出
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="Bronchoscopy" />
                                &ensp;Bronchoscopy
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="送檢/ C-T" />
                                &ensp;送檢/ C-T
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="On endo" />
                                &ensp;On endo
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="CPCR/999" />
                                &ensp;CPCR/999
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="P.O" />
                                &ensp;P.O
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="打survanta" />
                                &ensp;打survanta
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="check VC" />
                                &ensp;check VC
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="脫離MV" />
                                &ensp;脫離MV
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="脫離MV(拔管)" />
                                &ensp;脫離MV(拔管)
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="BIPAP" />
                                &ensp;BIPAP
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="脫離BIPAP" />
                                &ensp;脫離BIPAP
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="HF-N-CPAP" />
                                &ensp;HF-N-CPAP
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="脫離HF-N-CPAP" />
                                &ensp;脫離HF-N-CPAP
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="NPV" />
                                &ensp;NPV
                            </label>&ensp;
                            <label>
                                <input type="checkbox" v-model="checkList" value="NPV脫離" />
                                &ensp;NPV脫離
                            </label>&ensp;<br />
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">呼吸器脫離代號</div>
                        <div class="panel-body">
                            @foreach (var item in RCS.Controllers.RTRecordController.qc_item)
                            {
                                <label>
                                    <input type="checkbox" v-model="checkList" value="@(item.Text    )" />
                                    &ensp;@(item.Value).@(item.Text) 
                                </label>
                                @:&ensp;
                             }
                        </div>
                    </div> 
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal --> 
</div>
<div id="cxr_panel">
    <cxr-paint v-bind:config="config" ref="cxr"></cxr-paint>
</div> 
<script>
    var cxr_panel_set_vm = {
        config:{
            keyId:'@(string.IsNullOrWhiteSpace(Model.RECORD_ID)?"":Model.RECORD_ID)'
            ,tableName:'RCS_RECORD_DETAIL' 
            ,saveDataSelect:'#rt_record_form #CXR_result_json'
            ,tempData:''
    } };//預設物件
    var cxr_panel_vm = new Vue({
        el: '#cxr_panel',
        data: [ cxr_panel_set_vm,{}].reduce(function (r, o) {
            Object.keys(o).forEach(function (k) {
                r[k] = o[k];
            });
            return r;
        }, {}),
        methods: {
            //Vue Instance 在初始化時可設定選項物件，其中可設定 method，執行一些動作。
            open:function(){
                $('#cxr_modal').modal('show');
            },
            save:function(){
                return this.$refs.cxr.loadCXRDataToForm();
            }
        }
    });
</script>
<script>
    var work_panel_set_vm = {checkList:[]};//預設物件
    var work_panel_vm = new Vue({
        el: '#work_panel_div', 
        data: [ work_panel_set_vm,{}].reduce(function (r, o) {
            Object.keys(o).forEach(function (k) {
                r[k] = o[k];
            });
            return r;
        }, {}),
        mounted: function () {
            //元素已掛載，el被建立
        
        },
        methods: {
            //Vue Instance 在初始化時可設定選項物件，其中可設定 method，執行一些動作。
            save:function() {
                $('#rt_record_form #work_data').val(JSON.stringify(this.checkList)); 
                $('#work_panel').modal("hide");
            } ,
            open:function(){
                if (!!$('#rt_record_form #work_data').val()) {
                    this.checkList = JSON.parse($('#rt_record_form #work_data').val()); 
                }else {
                    this.checkList=[]; 
                } 
                $('#work_panel').modal("show");
            } 
        },
        computed:{
            //當我們定義一個 computed，其相依 data 一變，computed 也會隨之更新。

        },
        watch:{
            //當事件觸發時，瀏覽器叫事件處理器work。

        }
    }); 

</script>
<script type="text/javascript">
    var VIPtag = @VIPtag.ToString().ToLower();
    var RECORDData = JSON.parse('@Html.Raw(RECORDData)') ;  //20181106此行會造成部分特定字元錯誤，如 \、"" 
    var getLastData = ''; //最後一筆資料ID 
    //變粉藍色的欄位
    var babyblue_field = ["vt", "pressure_peak", "pressure_peep"];
    //全域表單資料
    var record_form_data;

    function onkeyup_Textarea_Count(show_id,value_id){
        if (!!$('#' + value_id).val()) {
            $('#' + show_id).text($('#' + value_id).val().length);
        } else {
            $('#' + show_id).text('');
        }
    }

    function clear_tube() {
        $("#rt_record_panel .mustIntubate").each(function () {
            $(this).val('');
            checkFunhasMode();
        });
    }

    @*function get_cpt_data()
    {
        $.ajax({
            url: '@Url.Content("~/RT/cpt_data")',
            type: 'POST',
            dataType: 'json',
            success: function (data) {
                if ($('#memo').val().length> 0) {
                    $('#memo').val($('#memo').val()+ ' ' + data);
                }else {
                    $('#memo').val(data);
                }
                return false;
            },
            error: function (jqXHR) {
                log(jqXHR);
            }
        });
        return false;
    }*@

    function RTRecord_keyup(pVal) {
        var _pVal = '';
        switch (pVal) {
            case'oi':
                var _fio2_set = $('#rt_record_form_panel #fio2_set').val();                
                var _abg_pao2 = $('#rt_record_form_panel #abg_pao2').val();
                var _pressure_mean = $('#rt_record_form_panel #pressure_mean').val();
                if ( !!_fio2_set && Boolean(typeof Number(_fio2_set) === 'number') &&                   
                   !!_abg_pao2 && Boolean(typeof Number(_abg_pao2) === 'number') && 
                    !!_pressure_mean && Boolean(typeof Number(_pressure_mean) === 'number') ) {
                    //OI = （Fio2xMAP）/PaO2                    
                    _pVal = ( (Number(_fio2_set)*Number(_pressure_mean))/Number(_abg_pao2) ).toFixed(2)
                }
                if (_pVal.toString() == 'NaN') _pVal = '';
                $('#rt_record_form_panel #oi').val(_pVal);
                break;
            case'pao2_fio2':
                var _fio2_set = $('#rt_record_form_panel #fio2_set').val();                
                var _abg_pao2 = $('#rt_record_form_panel #abg_pao2').val();
                if (!!_fio2_set && Boolean(typeof Number(_fio2_set) === 'number') &&                   
                   !!_abg_pao2 && Boolean(typeof Number(_abg_pao2) === 'number') ) {
                    //PaO2/FiO2= PaO2/FiO2                    
                    _pVal = ( Number(_abg_pao2)/Number(_fio2_set) ).toFixed(0)
                }
                if (_pVal.toString() == 'NaN') _pVal = '';
                $('#rt_record_form_panel #pao2_fio2').val(_pVal);
                break;
            case'cuff_leak_ml':
                var _cuff_leak_ml = $('#rt_record_form_panel #cuff_leak_ml').val();
                if (!!_cuff_leak_ml && Boolean(typeof Number(_cuff_leak_ml) === 'number'))
                    //Cuff-leak(%) = Cuff-leak(ml)/500
                    _pVal = (Number(_cuff_leak_ml) /500).toFixed(2)
                if (_pVal.toString() == 'NaN') _pVal = '';
                $('#rt_record_form_panel #cuff_leak_percent').val(_pVal);
                break;
            case'rsbi':
                _pVal = '';
                var _mv_value = $('#rt_record_form_panel #mv_value').val();
                var _rsi_srr = $('#rt_record_form_panel #rsi_srr').val();
                if (!!_mv_value && Boolean(typeof Number(_mv_value) === 'number') &&
                    !!_rsi_srr && Boolean(typeof Number(_rsi_srr) === 'number')) {
                    //VT=(VE*1000)/Srr
                    _pVal = ((Number(_mv_value)*1000)/Number(_rsi_srr)).toFixed(0)
                }
                if (_pVal.toString() == 'NaN') _pVal = '';
                $('#rt_record_form_panel #vt_value').val(_pVal);
                _pVal = '';
                var _vt_value = $('#rt_record_form_panel #vt_value').val();
                if (!!_vt_value && Boolean(typeof Number(_vt_value) === 'number') &&
                    !!_rsi_srr && Boolean(typeof Number(_rsi_srr) === 'number')) {
                    //RSI=Srr/(VT/1000)
                    _pVal = (Number(_rsi_srr) /(Number(_vt_value) /1000)).toFixed(0)
                }
                if (_pVal.toString() == 'NaN') _pVal = '';
                $('#rt_record_form_panel #rsbi').val(_pVal);
                break;
            case'abg_paado2':
                var _fio2_set = $('#rt_record_form_panel #fio2_set').val();
                _fio2_set = _fio2_set.replace('%','');
                var _abg_paco2 = $('#rt_record_form_panel #abg_paco2').val();
                var _abg_pao2 = $('#rt_record_form_panel #abg_pao2').val();
                if (!!_fio2_set && Boolean(typeof Number(_fio2_set) === 'number') &&
                   !!_abg_paco2 && Boolean(typeof Number(_abg_paco2) === 'number') &&
                   !!_abg_pao2 && Boolean(typeof Number(_abg_pao2) === 'number') ) {
                    //P(A-a)DO2=((FiO2 set/100)*713 - (5/4*(PCO2)) - (PO2)
                    //paao2 公式 ( ((fio2_set 除 100 )* 713 -(5/4*(paCO2)) ) - PaO2 )  四捨五入  兩
                    _pVal = ((Number(_fio2_set)/100) * 713 - (5/4*Number(_abg_paco2)) -Number(_abg_pao2) ).toFixed(2)
                }
                if (_pVal.toString() == 'NaN') _pVal = '';
                $('#rt_record_form_panel #abg_paado2').val(_pVal);
                break;
            default:
                break;
        }
        if (!!_pVal) {
            showAlert('計算ok!', msg_stat.Success);
        }else {
            showAlert('請確認計算欄位輸入正確!', msg_stat.Warning);
        }
    }


    function getByTurnOrLastRecordData(recordID,notO2device) {
        var RECORD = new Object();
        var rt_record = new Object();
        rt_record.recorddate = $('#rt_record_form_panel #recorddate').val();
        rt_record.recordtime = $('#rt_record_form_panel #recordtime').val();
        RECORD.RECORD_ID = recordID;
        RECORD.lastRecordID = getLastData; 
        RECORD.rt_record = rt_record;
        //重新取得最新呼吸照護記錄單資料
        $.ajax({
            url: '@Url.Content("~/RTRecord/getThisRecordData")',
            data: { rowStr: encodeURIComponent(JSON.stringify(RECORD)),setIpdno: $('#SearchTitle #setIpdno').val() ,target: "get_last" },
            type: 'POST',
            dataType: 'json',
            success: function (data) {
                //console.log(JSON.stringify(data));
                if (data.isWsError == true) {
                    showAlert(data.wsError, msg_stat.Danger);
                } else {
                    if (!!notO2device) {
                        if(!!data.rt_record){
                            data.rt_record.device_o2 = '';
                        }
                    }
                    console.log(data)
                    re_record_carryin(data, "get_last");
                }
            },
            error: function (jqXHR) {
                log(jqXHR);
            }
        });
    } 
   
    //帶入資料
    function re_record_carryin(data, target) {
        //console.log(JSON.stringify(data));
        // 處理主表單資料
        fillJsonDom('rt_record_form_master_panel', data, target);
        fillJsonDom('rt_record_form_panel', data.rt_record, target);
        $('#rt_record_form').find('input').each(function () {
            $(this).trigger("keyup");
        });
        $('#rt_record_form').find('textarea').each(function () {
            $(this).trigger("keyup");
        }); 
        //data.onBreath.WEANINGDATE = null; 
        checkFunhasMode();
        //判斷是否顯示欄位畫面
        //.dataRow
        $('#rt_record_panel .dataRow').each(function(){
            var _lable = $(this).attr('aria-label');
            if(_lable.length > 0){
                var _id = '#' + _lable + 'DataPanel';
                var hasVal = false;
                $(_id + ' [name*='+_lable+'_]').each(function(){
                    if($(this).val().length>0) hasVal = true;
                });
                if (hasVal) $(this).trigger('click');
            }
        });

        //判斷是否變粉藍色
        babyblue_field.forEach(function (entry) {
            if (data.onBreath.hasData || data.rt_record.device != "") {
                $("#rt_record_panel #" + entry).css("background-color", "#C8EEFA");
            } else {
                $("#rt_record_panel #" + entry).css("background-color", "#FFFFFF");
            }
        }); 
        //計算天數data.useDays
        if (data.useDays == null || data.useDays == undefined) data.useDays = 0;
        $('#rt_record_form_panel #useDays').val(data.useDays + ' 天');

        //debugger;
        if (target != "get_last") {
            // 設定datetimepicker
            maya_datetimepicker("#rt_record_panel .dt-picker"); 
            //設定是否唯讀 hasPower
            setRecodRule("#rt_record_panel", data.hasPowerEdit, type_mode);
            // set_readonly("#rt_record_panel", data.hasPowerEdit, 'RTRecord', type_mode);

            //console.log(data);
            //判斷標註焦點區塊 
        }

        //使datetime picker觸發change，設定結束時間限制
        $('#rt_record_panel .dt-picker').trigger("change");
 
    }

    //取得呼吸照護記錄單資料
    function BindRecordData(RECORD, isVIP) {
        // 初始化表單
        $("#rt_record_form")[0].reset(); 
        $("#rt_record_form input:hidden").val("");//hidden值另外清除 
        $("#custom_vs_doc").empty();// 醫師清單還原
        vs_doc_list.forEach(function (entry) {
            $("#custom_vs_doc").append("<option value=\"" + entry.value + "\">" + entry.text + "</option>");
        });
        //重新取得最新呼吸照護記錄單資料
        $.ajax({
            url: '@Url.Content("~/RTRecord/getThisRecordData")',
            data: { rowStr: encodeURIComponent(JSON.stringify(RECORD)),setIpdno: $('#SearchTitle #setIpdno').val() },
            type: 'POST',
            dataType: 'json',
            success: function (data) {
                //console.log(JSON.stringify(data));
                if (data.isWsError == true) {
                    showAlert(data.wsError, msg_stat.Danger);
                } else {
                    // 選取指定醫師若無則指定主治醫師
                    if (data.pat_info.case_vs_name == null) {
                        $("#custom_vs_doc option").filter(function () { return $(this).text() == data.pat_info.vs_doc; }).prop("selected", true);
                    } else {
                        // 把主治醫師補上清單
                        if ($("#custom_vs_doc").find("option[value='" + data.pat_info.vs_doc + "']").length == 0) {
                            $("#custom_vs_doc").append("<option value=\"" + data.pat_info.vs_id + "\">" + data.pat_info.vs_doc + "</option>");
                        }
                        $("#custom_vs_doc option").filter(function () { return $(this).text() == data.pat_info.case_vs_name; }).prop("selected", true);
                    }
                    // 處理主表單資料
                    getLastData = data.lastRecordID; 
                    //嘗試脫離重置
                    $("#breath_panel #breath_weaning").empty(); 
                    re_record_carryin(data);
                    //新表單要做的事情
                    if (RECORD == null || RECORD.RECORD_ID == null || RECORD.RECORD_ID == undefined || RECORD.RECORD_ID == '') {
                        $("#rt_record_panel [data-func='delete']").hide();//關閉刪除紐
                    } else {

                    }
                    // 顯示主表
                    $("#rt_record_panel").modal("show");
                    $("#index_loading").modal('hide'); 
                    $('#RTRECORD_FUNC').show();
                    @if (Model.hasRWC)
                    {
                         @:RWAC_vm.open($('#now_patient').attr('chart_no'), $('#now_patient').attr('ipd_no'));
                    }
                    // 禁止自動完成
                    setTimeout(function () { $("#rt_record_panel .form-control").attr("autocomplete", "off"); }, 100);
                    //延遲警告財編未設定
                    setTimeout(function () {
                        if (data.rt_record.respid == "201" && type_mode != "H") {
                            showAlert('呼吸器財產編號尚未設定，請先手動下拉清單設定財編，並通知主管協助處理。', msg_stat.Warning);
                        }
                    }, 2000);
                    
                }//if (data.isWsError == true)
            },//success
            error: function (jqXHR) {
                log(jqXHR);
            }
        });
    }

    function setRecordFormData(){
        //儲存cxr
        cxr_panel_vm.save();
        var objJson = getJsonObject('rt_record_form_master_panel');//主要資料
        var rt_record = getJsonObject('rt_record_form_panel');//主要資料
        var intubateDataPanel = getJsonObject('intubateDataPanel');//插管資料
        var breathDataPanel = getJsonObject('breathDataPanel');//呼吸資料
        var oxygenDataPanel = getJsonObject('oxygenDataPanel');//氧療資料
        objJson['rt_record'] = rt_record;
        objJson['onIntubate'] = intubateDataPanel;
        var Breathlist = new Array();
        $("#breath_panel #breath_weaning li").each(function () {
            var datalist = new Array();
            $(this).find('input').each(function () {
                var data = new Object();
                data.id = $(this).attr('id');
                if ($(this).attr('type') == 'checkbox' && $(this).prop('checked')) {
                    data.chkd = true;
                } else {
                    data.chkd = false;
                }
                data.val = $(this).val();
                datalist.push(data);
            });
            Breathlist.push(datalist);
        });
        breathDataPanel.WEANINGDATE = Breathlist;
        objJson['onBreath'] = breathDataPanel;
        objJson['onOxygen'] = oxygenDataPanel;
        //自訂醫生
        objJson["custom_vs_doc"] = $("#rt_record_panel #custom_vs_doc :selected").text();
        objJson["custom_vs_id"] = $("#rt_record_panel #custom_vs_doc :selected").val();
        return objJson;
    }
     
    //儀器狀態

    function switchChangeDevice(pThis){

    }

    var phrase_table, target_id, vs_doc_list = [];

    // 載入表單後將表單事件全部綁上
    $(document).ready(function () {
        $("#index_loading").modal('show');
        //switch 樣式
        //$(".BSSwitch").bootstrapSwitch();
        //onSwitchChange
                
        $('#intubate_switch input').bootstrapSwitch('toggleReadonly',true); //關閉插管編輯
        $('#breath_switch input').bootstrapSwitch('toggleReadonly',true);
        $('#oxygen_switch input').bootstrapSwitch('toggleReadonly',true);
        $("div").removeClass("bootstrap-switch-readonly"); //移除class

        //縮放
        $('#rt_record_panel .panel_head').on('click', function () {
            var _the = $(this);
            var _lable = $(this).attr('aria-label');
            if(_lable.length>0){
                var _id = '#' + _lable + 'DataPanel';
                $(_id).toggle(function () {
                    if($(_id).css('display') != 'none'){
                        _the.removeClass('fa-chevron-circle-right');
                        _the.addClass('fa-chevron-circle-down');
                    }else {
                        _the.removeClass('fa-chevron-circle-down');
                        _the.addClass('fa-chevron-circle-right');
                    }
                });
            }
        });
        $('#rt_record_panel .panel_head').each(function(){
            $(this).attr('title','檢視' +  $(this).html());
            var _lable = $(this).attr('aria-label');
            if(_lable.length > 0){
                var _id = '#' + _lable + 'DataPanel';
                $(this).trigger('click');
            }
        });

        // 處理呼吸器財編
        $("#rt_record_panel #respid option").each(function () {
            var tmp = $(this).val().split("|");
            $(this).attr({
                "value": tmp[0].trim(),
                "data-carry": tmp[1]
            });
        });

        // 設定自訂醫師清單
        $("#rt_record_panel #custom_vs_doc option").each(function () {
            vs_doc_list.push({ text: $(this).text(), value: $(this).val() });
        });

        // 固定顏色為粉紅
        var pink_field = ["cuff", "pr", "bpd", "bps", "spo2"];
        pink_field.forEach(function (entry) {
            $("#rt_record_panel #" + entry).css("background-color", "#FDE4E4");
        });

        // 所有按鈕
        $("#rt_record_panel button.exec-func,#rt_record_panel a.exec-func, .phraseCarry button.exec-func").unbind('click').bind('click', function () {
            var btn_dom = $(this);
            switch ($(this).attr("data-func")) {
                case "save":
                    btn_dom.button("loading");
                    var $objJson = setRecordFormData();//主要資料
                    $.ajax({
                        url: '@Url.Content("~/RTRecord/RTRecordFormSave")',
                        type: 'POST',
                        data:
                            {
                            rowStr: encodeURIComponent(JSON.stringify($objJson))
                            , setIpdno:$('#SearchTitle #setIpdno').val()
                            },
                        success: function (data) {
                            if (data.status == 0) {
                                showAlert(data.message, msg_stat.Success);
                                $("#rt_record_panel").modal("hide");
                                if ($("#nav_tabs > li[class~='active'] > a").attr('data-target') == '#tab_rt_record') {
                                    record_list_search();
                                }
                            } else {
                                if(data.status == 4){
                                    showAlert(data.message, msg_stat.Warning);
                                    $("#rt_record_panel").modal("hide");
                                    if ($("#nav_tabs > li[class~='active'] > a").attr('data-target') == '#tab_rt_record') {
                                        record_list_search();
                                    }
                                }else {
                                    showAlert(data.message, msg_stat.Danger);
                                }
                            }
                        },
                        beforeSend: function () {
                            //修改狀態，判斷該筆資料是否已上傳(RCS_RECORD_MASTER.UPLOAD_STATUS=”1”)，顯示確認訊息
                            if (($objJson.UPLOAD_STATUS == '1' && confirm('該筆資料已上傳，您是否確定要修改?')) || $objJson.UPLOAD_STATUS != '1') {
                                return true;
                            } else {
                                btn_dom.button("reset");
                                return false;
                            }
                        },
                        complete: function () {
                            btn_dom.button("reset");
                        },
                        error: function (jqXHR) {
                            showAlert("發生內部錯誤(" + jqXHR.status + ")，請聯絡資訊人員", msg_stat.Warning);
                            log(jqXHR);
                        }
                    });
                    break;
                case "delete":
                    //刪除
                    if (confirm('您是否確認刪除此筆記錄?')) {
                        $.ajax({
                            url: '@Url.Content("~/RTRecord/RTRecordFormDel")',
                            type: 'POST',
                            dataType: 'json',
                            data: {
                                record_id: $("#rt_record_panel #RECORD_ID").val(), 
                                recorddate: $("#rt_record_panel #recorddate").val() + ' ' + $("#rt_record_panel #recordtime").val() + ':00'
                            },
                            success: function (data) {
                                if (data.status == 0) {
                                    showAlert(data.message, msg_stat.Success);
                                    record_list_search();
                                    $("#rt_record_panel").modal("hide");
                                } else {
                                    showAlert(data.message, msg_stat.Warning);
                                }
                            },
                            beforeSend: function () {
                                btn_dom.button("loading");
                            },
                            complete: function () {
                                btn_dom.button("reset");
                            },
                            error: function (jqXHR) {
                                showAlert("發生內部錯誤(" + jqXHR.status + ")，請聯絡資訊人員", msg_stat.Warning);
                                log(jqXHR);
                            }
                        });
                    };
                    break;
                case "last_data":
                    //取得最後一筆
                    getByTurnOrLastRecordData(getLastData);
                    break;
                case "getBreathList":
                    //取得呼吸器清單 Breath_table
                    $('#Breath_table').bootstrapTable("refresh");
                    $('#BreathListModal').modal('show');
                    break;
                case "carry-in":
                    // 帶入片語
                    var sel_data = phrase_table.bootstrapTable("getSelections");
                    var target = $("#rt_record_panel " + target_id);
                    var tempArray = new Array();
                    if (target.val() != '') tempArray.push(target.val());
                    for (var i = 0; i <= sel_data.length - 1; i++) {
                        tempArray.push(sel_data[i].P_VALUE);
                    }
                    target.val(tempArray.join());
                    $("#phrase_panel").modal("hide");
                    break;
                case "phrase":
                    // 開啟片語選取
                    target_id = $(this).attr("data-target");
                    phrase_table.bootstrapTable("refresh");
                    $("#phrase_panel").modal("show");
                    break;
                case 'showLabData':
                    //取得檢驗資料
                    $('#labdata_table').bootstrapTable("refresh");
                    $("#labdata_table_panel").modal("show");
                    break;
                case 'showLabALLData':
                    //取得檢驗資料
                    $.ajax({
                        url: '@Url.Content("~/RTRecord/getBloodBiochemicalData")',
                        type: 'POST',
                        dataType: 'json',
                        success: function (data) {
                            //console.log(data);
                            if (data != null && data != undefined && data.length > 0) {
                                var tempHtml = '', cnt = 1;
                                for (var i in data) {
                                    //console.log(i);
                                    if (i != 'remove') {
                                        var obj = data[i], itemHtml = '';
                                        $('#LabDataBlock #LabDataDiv').html('');
                                        $('#LabDataBlock legend').html(obj.examDate);
                                        for (var j in obj.examContent) {
                                            //console.log(j);
                                            if (j != 'remove') {
                                                var content = obj.examContent[j];
                                                if (!!content.name) {
                                                    $('#LabDataItem input').attr('id', j + cnt);
                                                    $('#LabDataItem label').attr('for', j + cnt);
                                                    $('#LabDataItem label').html(content.name + ' ' + content.result + ' ' + content.unit);
                                                    itemHtml += $('#LabDataItem').html();
                                                }
                                                 
                                            }
                                        }
                                        if (itemHtml != '')
                                            $('#LabDataBlock #LabDataDiv').html(itemHtml);
                                        else
                                            $('#LabDataBlock #LabDataDiv').html('查無血液生化檢驗項目!');
                                        tempHtml += $('#LabDataBlock').html();
                                        cnt++;
                                    }
                                }
                                $('#LabDatabody').html(tempHtml);
                            } else {
                                $('#LabDatabody').html('查無檢驗資料!');
                            }
                        },
                        beforeSend: function () {
                            btn_dom.button("loading");
                        },
                        complete: function () {
                            btn_dom.button("reset");
                            $("#LabData_panel").modal("show");
                        },
                        error: function (jqXHR) {
                            showAlert("發生內部錯誤(" + jqXHR.status + ")，請聯絡資訊人員", msg_stat.Warning);
                            log(jqXHR);
                        }
                    });
                    break;
                case 'getLabData':
                    var memoTarget = $('#rt_record_panel #memo');
                    var bbMemo = $('#rt_record_panel #Blood_biochemistry_memo');
                    var bbArray = new Array();
                    var LabDataArray = new Array();
                    if (memoTarget.val() != '')LabDataArray.push(memoTarget.val());
                    $('#LabDatabody input:checked').each(function () {
                        LabDataArray.push($('#LabDatabody label[for="' + $(this).attr('id') + '"]').html());
                        bbArray.push($('#LabDatabody label[for="' + $(this).attr('id') + '"]').html());
                    });
                    bbMemo.val(bbArray.join());
                    memoTarget.val(LabDataArray.join());
                    $("#LabData_panel").modal("hide");
                    break;
                case "get_abg":
                    //取得3天內最新Abg
                    target_id = $(this).attr("data-target");
                    abg_table.bootstrapTable("refresh");
                    $("#abg_panel").modal("show");
                    break;
                default:
                    showAlert($(this).attr("data-func") + "無此功能", msg_stat.Warning);
                    break;
            }
            return false;
        });

        // 消除呼吸記錄單關閉後會讓卷軸消失的bug
        // 消除ABG關閉後會讓卷軸消失的bug
        // 消除檢驗資料關閉後會讓卷軸消失的bug
        // 消除片語關閉後會讓卷軸消失的bug   setScrollbar
        $(".setScrollbar").unbind("hidden.bs.modal").on("hidden.bs.modal", function (e) {
            setTimeout(function () { $("#mybody").addClass("modal-open"); }, 0);
        });

        // 片語的table
        phrase_table = $("#phrase_table").bootstrapTable({
            url: "@Url.Content("~/RTRecord/GetPhraseData")", toolbarAlign: "right",
            method: "post", search: true, clickToSelect: true,
            pagination: true,pageSize: 10,
            queryParams: function () { return { "type": target_id }; },
            toolbar: "#phrase_toolbar"
        });
        //呼吸器清單
        $('#Breath_table').bootstrapTable({
            url: "@Url.Content("~/RTRecord/getBreathList")", toolbarAlign: "right",
            flat: true,
            method: "post", search: true, clickToSelect: true
        }).on('click-row.bs.table', function (e, row, index) {
            //getLast 方式取得資料
            getByTurnOrLastRecordData(row.RECORD_ID,true);
            $('#BreathListModal').modal('hide');
        });


        // 血液生化的table
        $('#labdata_table').bootstrapTable({
            url: "@Url.Content("~/RTRecord/getBloodBiochemicalData")", toolbarAlign: "right",
            flat: true,
            method: "post", search: true, clickToSelect: true,
            queryParams: function () { return { "type": target_id }; }
        }).on('click-row.bs.table', function (e, row, index) {
            $('#biochemDataPanel [name*=biochem_]').val('');
            $('#biochemDataPanel #biochem_hb').val(row['examContent.Hb.result']);
            $('#biochemDataPanel #biochem_ht').val(row['examContent.Ht.result']);
            $('#biochemDataPanel #biochem_wbc').val(row['examContent.WBC.result']);
            $('#biochemDataPanel #biochem_p').val(row['examContent.Platelet.result']);
            $('#biochemDataPanel #biochem_na').val(row['examContent.Na.result']);
            $('#biochemDataPanel #biochem_k').val(row['examContent.K.result']);
            $('#biochemDataPanel #biochem_bun').val(row['examContent.BUN.result']);
            $('#biochemDataPanel #biochem_cr').val(row['examContent.Cr.result']);
            $('#biochemDataPanel #biochem_albumin_sugar').val(row['examContent.Albumin.result']);
            $("#labdata_table_panel").modal("hide");
        });
        //console.log($('#labdata_table').bootstrapTable('getData'));

        // ABG的table
        abg_table = $("#abg_table").bootstrapTable({
            url: "@Url.Content("~/RTRecord/GetLastAbgList")", toolbarAlign: "right",
            method: "post", search: true, clickToSelect: true,
            queryParams: function () { return { "type": target_id }; },
            toolbar: "#abg_toolbar"
        }).on('click-row.bs.table', function (e, row, index) {
            //先清空ABG相關欄位
            $("#rt_record_form [name*=abg_]").val("");
            $("#rt_record_form #abg_time").val(row.Date);
            $("#rt_record_form #abg_ph").val(row.pH);
            $("#rt_record_form #abg_paco2").val(row.PCO2);
            $("#rt_record_form #abg_pao2").val(row.PO2);
            $("#rt_record_form #abg_sao2").val(row.SaO2);
            $("#rt_record_form #abg_hco3").val(row.HCO3);
            $("#rt_record_form #abg_be").val(row.BaseExcess);
            //$("#rt_record_form #spo2").val(row.pulse_oximeter);
            $("#abg_panel").modal("hide");
        });
        // 綁定可編輯下拉
        $("#rt_record_panel .editable_select").each(function () {
            $(this).editableSelect({
                effects: 'slide',
                filter: false,
                appendTo: $('#rt_record_panel'),
                onSelect: function (element) {
                    $(this).trigger("keyup");
                }
            });
        });



        //呼吸器編號切換時帶入Ventilator Type
        $("#rt_record_form #respid").unbind("change").change(function () {
            $("#rt_record_form #device").val($(this).find("option:selected").attr("data-carry"));
            $("#rt_record_form #device").trigger("keyup");
        });

        // enter to next tab
        $("#rt_record_form input").unbind("keypress").keypress(function (e) {
            if (e.which == 13) {
                var current_index = parseInt($(this).attr("tabindex")) + 1;
                $("#rt_record_form input[tabindex='" + current_index + "']").focus();
                // fixed keypress enter then auto submit form problem, Joe 2016.4.11
                return false;
            }
        });

        //自動ON呼吸器的判定
        $("#rt_record_form #device").keyup(function () {
            // 有ON呼吸器顏色為粉藍
            babyblue_field.forEach(function (entry) {
                if ($("#plugin_data_panel #breath_start_date").val() != "") {
                    $("#rt_record_panel #" + entry).css("background-color", "#C8EEFA");
                } else {
                    $("#rt_record_panel #" + entry).css("background-color", "#FFFFFF");
                }
            });
        })

        // 警示標色
        $("#rt_record_form .form-control").keyup(function () {
            // 指定要出現的顏色
            var high_color = "#FF0000", low_color = "#FF0000", ptn_color = high_color;
            var pattern = null;

            // 恢復正常
            $(this).css("color", "");

            // 設定條件
            if (typeof ($(this).attr("data-max")) !== "undefined") {
                if (parseFloat($(this).val()) > parseFloat($(this).attr("data-max"))) {
                    // 不為空且值小於
                    $(this).css("color", low_color);
                }
            }
            if (typeof ($(this).attr("data-min")) !== "undefined") {
                if (parseFloat($(this).val()) < parseFloat($(this).attr("data-min"))) {
                    // 不為空且值大於
                    $(this).css("color", high_color);
                }
            }
            if (typeof ($(this).attr("data-pattern")) !== "undefined") {
                pattern = $(this).attr("data-pattern").split("|");
                if (pattern.indexOf($(this).val()) !== -1) {
                    // 不為空且值發現值
                    $(this).css("color", ptn_color);
                }
            }
        });
 
        setcheckboxRules('rt_record_panel'); 
        $('#rt_record_panel .hasMode').each(function () {  
            checkFunhasMode();
            $(this).on('keyup change dp.change', function(){
                checkFunhasMode();
            }); 
        }); 
        RECORDData.rt_record.memo = $('#rt_record_form #memo').html();
        RECORDData.rt_record.drug_memo = $('#rt_record_form #drug_memo').html();
        BindRecordData(RECORDData, VIPtag);
 

    });

    function checkFunhasMode(){ 
        var hasData = false;
        $('#rt_record_panel .hasIntubate').each(function () {
            if ($(this).val()) {
                hasData = true
            }
        });
        if (hasData) { 
            //$('#intubate_switch').removeClass('fa-toggle-off').addClass('fa-toggle-on');
            $('#intubate_switch input').bootstrapSwitch('toggleReadonly',false);//開啟插管編輯
            $('#intubate_switch input').bootstrapSwitch('state',true); //修改插管狀態
            $('#intubate_switch input').bootstrapSwitch('toggleReadonly',true);//關閉插管編輯
        }else{
            //$('#intubate_switch').removeClass('fa-toggle-on').addClass('fa-toggle-off');
            $('#intubate_switch input').bootstrapSwitch('toggleReadonly',false);
            $('#intubate_switch input').bootstrapSwitch('state',false);
            $('#intubate_switch input').bootstrapSwitch('toggleReadonly',true);
        }

        hasData = false;
        $('#rt_record_panel .hasBreah').each(function () {
            if ($(this).val()) {
                hasData = true
            }
        });
        if (hasData) { 
            //$('#breath_switch').removeClass('fa-toggle-off').addClass('fa-toggle-on');
            $('#breath_switch input').bootstrapSwitch('toggleReadonly',false);
            $('#breath_switch input').bootstrapSwitch('state',true);
            $('#breath_switch input').bootstrapSwitch('toggleReadonly',true);
        }else{
            //$('#breath_switch').removeClass('fa-toggle-on').addClass('fa-toggle-off');
            $('#breath_switch input').bootstrapSwitch('toggleReadonly',false);
            $('#breath_switch input').bootstrapSwitch('state',false);
            $('#breath_switch input').bootstrapSwitch('toggleReadonly',true);
        }

        hasData = false;
        $('#rt_record_panel .hasOxygen').each(function () {
            if ($(this).val()) {
                hasData = true
            }
        });
        if (hasData) { 
            //$('#oxygen_switch').removeClass('fa-toggle-off').addClass('fa-toggle-on');
            $('#oxygen_switch input').bootstrapSwitch('toggleReadonly',false);
            $('#oxygen_switch input').bootstrapSwitch('state',true);
            $('#oxygen_switch input').bootstrapSwitch('toggleReadonly',true);
        }else{
            //$('#oxygen_switch').removeClass('fa-toggle-on').addClass('fa-toggle-off');
            $('#oxygen_switch input').bootstrapSwitch('toggleReadonly',false);
            $('#oxygen_switch input').bootstrapSwitch('state',false);
            $('#oxygen_switch input').bootstrapSwitch('toggleReadonly',true);
        }
    }
    
</script>



